const t=""+new URL("out_0-mQuEja6j.png",import.meta.url).href,i=[{n:"Level_0",w:68,t:22,i:"AQQcAD04E0wUTBVMFkwXTBFQElATUBRQFVAWUBdQGFAAVA9UEFQRVBJUE1QUVBVUFlQXVBhUGVQaVENUAAQJAEM0PDhDOEM8Q0BDRENIQ0xDUAEIAwAxPD08JUQCBAoAADAANAA4PjgAPABAAEQASABMAFABAD8APTQxOCVAFEgVSBZIEkwQUBlQAVQCVANUBFQFVAZUB1QIVAlUClQLVAxUDVQOVBtUHFQdVB5UH1QgVCFUIlQjVCRUJVQmVCdUKFQpVCpUK1QsVC1ULlQvVDBUMVQyVDNUNFQ1VDZUN1Q4VDlUOlQ7VDxUPVQ+VD9UQFRBVEJUAAgEABw8MDw8PCREAggEAB08Mjw+PCZEAgAIAAAsPjQdODI4JkAXSBhMGlAAAAgAQzA8NBw4MDgkQBNIEUwPUBNMAQAFRBJMAgAmHDgcEUwCACNQNlA="}];function s(t){function i(t){function i(t){return[8*(t%1024),8*Math.floor(t/1024)]}let s=[],h=function(t){const i=atob(t),s=i.length,h=new Uint8Array(s);for(let n=0;n<s;n++)h[n]=i.charCodeAt(n);return new Uint16Array(h.buffer)}(t);for(let n=0;n<h.length;){let t=h[n];n++;let e=h[n];n++;let r=[...h.slice(n,n+e)];n+=e,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:h,t:n,i:e}=t;return{name:s,w:h,t:n,i:i(e)}}))}const h=new class{image;info;h;o;async load(){var h;this.image=await(h=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=h}))),this.info="bar\n\n0*0*idle\n1*1*end\n2*2*middle\n3*3*thumb\n\n4*160*96\n4*160*126\n4*0*160\n4*80*160\n\n\nbullet\n\n0*3*idle\n4*6*hit\n7*8*flash\n9*10*flash2\n11*14*damage\n\n0*80*220\n0*96*220\n0*112*220\n0*128*220\n0*144*220\n0*160*220\n0*176*220\n0*192*220\n0*208*220\n0*224*220\n0*240*220\n0*240*190\n0*240*160\n0*240*126\n0*240*96\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*160*160\n4*0*190\n4*80*190\n4*160*190\n4*0*220\n\n\nmain_char\n\n0*1*idle\n2*6*run\n7*10*jump\n11*14*fall\n15*17*ledge\n18*19*knock\n20*21*skid\n\n0*0*250\n0*16*250\n0*32*250\n0*48*250\n0*64*250\n0*80*250\n0*96*250\n0*112*250\n0*128*250\n0*144*250\n0*160*250\n0*176*250\n0*192*250\n0*208*250\n0*224*250\n0*240*250\n0*0*266\n0*16*266\n0*32*266\n0*48*266\n0*64*266\n0*80*266\n\n\none_char\n\n0*1*idle\n2*4*hit\n\n0*96*266\n0*112*266\n0*128*266\n0*144*266\n0*160*266\n\n\nplus_char\n\n0*1*idle\n2*4*jumped\n5*6*damage\n\n0*176*266\n0*192*266\n0*208*266\n0*224*266\n0*240*266\n0*0*282\n0*16*282\n\n\ntiles\n\n0*0*idle\n\n3*0*0\n\n\ntwo_char\n\n0*3*idle\n4*5*damage\n6*8*split\n\n5*160*0\n5*192*0\n5*224*0\n5*160*32\n5*192*32\n5*224*32\n5*160*64\n5*192*64\n5*224*64".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,h]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,h]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:h}})),l:h.split(/\r?\n/).map((t=>{let[i,s,h,n,e,r,a,o]=function(t){let[i,s,h]=t,n=0,e=0,[r,a]=0===i?[16,16]:1===i?[32,16]:2===i?[80,80]:3===i?[160,160]:4===i?[80,30]:5===i?[32,32]:[0,0],[o,l]=[r,a];return[n,e,r,a,s,h,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:h,_:n,m:e,p:r,A:a,M:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],this.h=s(i),console.log(this.h)}};class n{constructor(t,i){this.canvas=t,this.v=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{v:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,h,n){let{v:e}=this;e.fillStyle=n,e.fillRect(t,i,s,h)}U(t,i){let{v:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{v:t}=this;t.restore()}V(t,i,s){let{fx:n,fy:e,m:r,p:a}=h.o,o=i-n,l=s-e,u=t%20*8,d=8*Math.floor(t/20);this.k(o,l,r+u,a+d,8,8)}B(t,i,s,h=1,n=1){let{fx:e,fy:r,m:a,p:o,A:l,M:u}=t.j,{D:d,F:c}=t,f=i-e-d,_=s-r-c;this.k(f,_,a,o,l,u,h,n)}k(t,i,s,n,e,r,a=1,o=1){let{v:l}=this,{image:u}=h;l.save();let d=e,c=r,f=d*Math.abs(a),_=c*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=f),o<0&&(i*=-1,i-=_),l.drawImage(u,s,n,d,c,Math.round(t),Math.round(i),Math.round(f),Math.round(_)),l.restore()}}const e={C:16,I:16,time:0,N(t,i=0){let{I:s,time:h}=this;return Math.floor((h-i-s)/t)<Math.floor((h-i)/t)}};class r{constructor(t,i){this.x=t,this.y=i,this.P=[],this.L=[]}R;J(t){return this.R=t,this}O;P;L;parent;get position(){return[this.x,this.y]}T(t,i){this.L.push([t,i])}S(t){return this.P.filter((i=>i instanceof t))}Z(t){return this.P.find((i=>i instanceof t))}G(t,i,s,h){let n=new t(s,h);return n.parent=this,n.J(i).init(),n}H(t,i={},s=0,h=s){let n=this.G(t,i,s,h);return this.P.push(n),n}remove(t){if(!t)return void this.parent?.remove(this);let i=this.P.indexOf(t);if(-1===i)throw"noscene rm";this.P.splice(i,1)}init(){return this.O=0,this.X(),this}update(){0===this.O&&this.$(),this.P.forEach((t=>t.update())),this.O+=e.I,this.L=this.L.map((([t,i])=>(t-e.I<0&&i(),[t-e.I,i]))).filter((t=>t[0]>0)),this.q()}draw(t){this.K(t),this.P.forEach((i=>i.draw(t))),this.W(t),this.Y(t)}X(){}$(){}q(){}W(t){}K(t){}Y(t){}}class a extends r{get data(){return this.R}get info(){let t=h.info.find((t=>t.name===this.tt));if(!t)throw`nosprite ${this.tt}`;return t}get duration(){return this.data.duration??.4}get tag(){let t=this.info.tags.find((t=>t.name===this.it));if(!t)throw`notag ${this.tt} ${this.it}`;return t}get tt(){return this.data.name}get it(){return this.data.tag||"idle"}x=0;y=0;st=1;ht=1;nt(t,i){this.x=t,this.y=i}_current_frame=0;get j(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get et(){return this.data.et??"c"}get D(){if("tl"===this.et)return 0;let{u:t}=this.j;return"c"===this.et||"bc"===this.et?t/2:0}get F(){if("tl"===this.et)return 0;let{_:t}=this.j;return"c"===this.et?t/2:"bc"===this.et?t:0}rt(t){this.data.tag=t,this._current_frame=0,this.ot=0}ot=0;q(){let{from:t,to:i}=this.tag,{duration:s}=this,h=s/(i-t+1),n=i-t;this.ot+=e.I,this.ot>=h&&(this.ot-=h,this._current_frame===n?this._current_frame=0:this._current_frame+=1)}W(t){let{x:i,y:s,st:h,ht:n}=this;t.B(this,i,s,h,n)}}const o=function(){let t=new Set;return document.addEventListener("keydown",(i=>(i=>{"ArrowUp"!==i.key&&"ArrowDown"!==i.key||i.preventDefault(),t.add(i.key)})(i))),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var l=function(){var t,i,s,h,n,e=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var h,n,e,a,l,u,d=o[t.lt[0]],c=t.lt[1],f=t.lt[3]/32,_=o[t.lt[4]],m=t.lt[5],g=t.lt[8]/32,p=t.lt[9],A=t.lt[10]*t.lt[10]*4,w=t.lt[11]*t.lt[11]*4,M=t.lt[12]*t.lt[12]*4,x=1/M,v=-t.lt[13]/16,y=t.lt[14],Q=s*2**(2-t.lt[15]),U=new Int32Array(A+w+M),V=0,k=0;for(h=0,n=0;h<A+w+M;h++,n++)n>=0&&(n-=Q,l=r(i+(15&(y=y>>8|(255&y)<<4))+t.lt[2]-128),u=r(i+(15&y)+t.lt[6]-128)*(1+8e-4*t.lt[7])),e=1,h<A?e=h/A:h>=A+w&&(e=(1-(e=(h-A-w)*x))*3**(v*e)),a=d(V+=l*e**f)*c,a+=_(k+=u*e**g)*m,p&&(a+=(2*Math.random()-1)*p),U[h]=80*a*e|0;return U},o=[e,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(e){t=e,i=e.ut,s=0,h=e.dt*e.ct*(i+1)*2,n=new Int32Array(h)},this.ft=function(){var r,l,u,d,c,f,_,m,g,p,A,w,M,x,v=new Int32Array(h),y=t._t[s],Q=t.dt,U=t.ct,V=0,k=0,b=!1,B=[];for(u=0;u<=i;++u)for(_=y.gt[u],d=0;d<U;++d){var j=_?y.c[_-1].f[d]:0;j&&(y.lt[j-1]=y.c[_-1].f[d+U]||0,j<17&&(B=[]));var D=o[y.lt[16]],E=y.lt[17]/512,F=2**(y.lt[18]-9)/Q,C=y.lt[19],I=y.lt[20],N=43.23529*y.lt[21]*3.141592/44100,P=1-y.lt[22]/255,L=1e-5*y.lt[23],R=y.lt[24]/32,J=y.lt[25]/512,O=6.283184*2**(y.lt[26]-9)/Q,T=y.lt[27]/255,z=y.lt[28]*Q&-2;for(A=(u*U+d)*Q,c=0;c<4;++c)if(f=_?y.c[_-1].n[d+c*U]:0){B[f]||(B[f]=a(y,f,Q));var S=B[f];for(l=0,r=2*A;l<S.length;l++,r+=2)v[r]+=S[l]}for(l=0;l<Q;l++)(p=v[m=2*(A+l)])||b?(w=N,C&&(w*=D(F*m)*E+.5),k+=(w=1.5*Math.sin(w))*(M=P*(p-k)-(V+=w*k)),p=3==I?k:1==I?M:V,L&&(p=(p*=L)<1?p>-1?e(.25*p):-1:1,p/=L),b=(p*=R)*p>1e-5,x=p*(1-(g=Math.sin(O*m)*J+.5)),p*=g):x=0,m>=z&&(x+=v[m-z+1]*T,p+=v[m-z]*T),v[m]=0|x,v[m+1]=0|p,n[m]+=0|x,n[m+1]+=0|p}return++s/t.At},this.wt=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var e=i.getChannelData(s),r=s;r<h;r+=2)e[r>>1]=n[r]/65536;return i}};const u=(t,i,s)=>({lt:t,gt:i,c:s}),d=(t,i)=>i.map((i=>({_t:[u(t,[1],[{n:[i],f:[]}])],dt:5513,ct:32,ut:0,At:1}))),c={_t:[{lt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],gt:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{lt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],gt:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{lt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],gt:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],dt:7350,ct:32,ut:22,At:3},f=d([3,63,128,36,0,166,112,181,25,3,4,4,67,32,156,1,0,195,6,0,3,51,186,127,212,0,2,29,3],[135,125]),_=d([1,63,104,51,1,140,104,0,47,49,11,24,79,144,108,5,0,195,6,0,2,64,92,174,124,19,4,56,3],[149,158,150]),m=d([1,63,130,0,0,87,130,0,0,12,8,15,40,144,104,5,0,195,6,0,2,64,92,174,124,19,4,63,2],[135,137,139]),g=d([1,206,96,20,3,204,104,23,23,11,27,49,72,104,51,5,1,231,13,0,2,38,157,51,32,4,4,119,2],[139]),p=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},h=[{name:"song",data:c},{name:"bullet0",data:f[0]},{name:"bullet1",data:f[1]},{name:"damage0",data:_[0]},{name:"damage1",data:_[1]},{name:"damage2",data:_[2]},{name:"jump0",data:m[0]},{name:"jump1",data:m[1]},{name:"jump2",data:m[2]},{name:"knock",data:g[0]}];return{ft:()=>(h.forEach((i=>{let h=new l;h.init(i.data),function n(){if(1===h.ft()){let n=h.wt(t);((t,i)=>{s[t]=i})(i.name,n)}else setTimeout(n,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==h.length?setTimeout(i,100):t()}()}))),play:(h,n=!1)=>{const e=s[h];if(!e)return;let r=t.createBufferSource(),a=t.createGain();return r.buffer=e,r.connect(a),a.connect(i),r.loop=n,a.gain.value=.8,r.start(),()=>{r.stop()}}}}();const A=10;let w=0;function M(t,i,s=.1){return(1-s)*t+s*i}function x(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function v(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function y(t){let i;const s=h=>{i=new h(0,0),i.J({g:t,go:s}),i.init()};s(U),function(t){let i;const s=h=>{e.C=e.I,e.I=Math.min(20,Math.max(16,i?h-i:16))/1e3,i=h,e.time+=e.I,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),i.draw(t)}))}class Q extends r{Mt=!1;xt;get data(){return this.R}get g(){return this.data.g}go(t){this.data.go(t)}update(){o("m")?this.Mt||(this.Mt=!0,this.xt?(this.xt(),this.xt=void 0):this.xt=p.play("song",!0)):this.Mt=!1,super.update()}}class U extends Q{X(){h.load().then((()=>{this.H(a,{name:"loading",tag:"audio",duration:1e3},160,90),p.ft().then((()=>{this.go(V)}))}))}}class V extends Q{map;X(){this.xt=p.play("song",!0),this.map=this.H(k)}}class k extends r{w;t;o;vt=0;yt=0;Qt=0;Ut=0;Vt=0;kt=0;bt=0;Bt=0;X(){const t=h.h[0];this.w=t.w,this.t=t.t,this.o=Array(t.t);for(let i=0;i<t.t;i++)this.o[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:h}=t.i[i],n=s[0]/8,e=s[1]/8,r=h[1]/8*20+h[0]/8;399===r?this.H(E,{},s[0],s[1]):398===r||(397===r?this.H(j,{},s[0],s[1]):this.o[e][n]=r)}}jt(t,i,s){return!!this.Dt(t,i,s)}Dt(t,i,s){let{x:h,y:n,w:e,t:r}=t;return this.Et(h-e/2+i,n-r/2+s,e,r)}Et(t,i,s=1,h=1){let n=this.o[0].length,e=this.o.length,r=t/8,a=i/8,o=(t+s-1)/8,l=(i+h-1)/8;if(r<0||o>=n||a<0||l>=e)return!0;for(t=r;t<=o;t++)for(i=a;i<=l;i++)if(t=Math.floor(t),i=Math.floor(i),I(this.o[i][t]))return[8*t,8*i]}q(){let t=this.Z(E);if(t){if(t&&void 0===t.Ft){let i=this.jt(t,0,4),s=this.Dt(t,1,-8)?void 0:this.Dt(t,1,0),h=this.Dt(t,-1,-8)?void 0:this.Dt(t,-1,0);i||(t.Ct&&Array.isArray(s)?(t.Ft=.4,t.x=s[0],t.y=s[1]):t.It&&Array.isArray(h)&&(t.Ft=.4,t.x=h[0]+8,t.y=h[1]))}if(t&&void 0===t.Ft&&void 0===t.Nt){let i=this.Dt(t,1,-8)?void 0:this.Dt(t,1,0),s=this.Dt(t,-1,-8)?void 0:this.Dt(t,-1,0);t.Ct&&Array.isArray(i)?(t.Nt=.13,t.x=i[0],t.y=i[1]-1):t.It&&Array.isArray(s)&&(t.Nt=-.13,t.x=s[0]+8,t.y=s[1]-1)}let i=this.Dt(t,0,0);void 0!==t.Ft&&(t.Ft=x(t.Ft,0,e.I),0===t.Ft&&(t.Ft=void 0,t.y=i[1]-8,t.dy=0)),void 0!==t.Nt&&(t.Nt=x(t.Nt,0,e.I),0===t.Nt&&(t.Nt=void 0,t.y=i[1]-8,t.dy=0)),t.Pt>0&&(this.bt=-1,this.Bt=-.2),this.Qt<t.x-8-30&&(this.Qt=t.x-8-30),this.Qt>t.x+8+30&&(this.Qt=t.x+8+30),this.Ut<t.y-8-30&&(this.Ut=t.y-8-30),this.Ut>t.y+8+30&&(this.Ut=t.y+8+30);let s=t.dx<0?-170:t.dx>0?-150:-160;this.vt=M(this.vt,this.Qt+s),this.yt=M(this.yt,this.Ut-90,.5),this.vt=Math.min(Math.max(0,this.vt),8*this.w-320)}let i=this.S(b);i.forEach((t=>{let i=Math.sign(t.dx),s=Math.abs(t.dx+t.Lt);t.Lt=s%1*i;let h=t.Rt;for(let n=0;n<s;n++){let s=i*e.I*10*h;if(this.jt(t,s,0)){t.Jt=i,t.dx=0;break}t.Jt=0,t.x+=s}})),i.forEach((t=>{{let i=Math.sign(t.dy),s=Math.abs(t.dy+t.Ot);t.Ot=s%1*i;for(let h=0;h<s;h+=1){let s=.5*i*e.I*e.I*80;if(this.jt(t,0,s)){t.Tt=i,t.dy/=2;break}{t.Tt=0,t.y+=s;let i=t.zt;t.dy=x(t.dy,0,9.8*e.I*i)}}}let i=t.St;if(t.dy>-50){let s=2800*9.8*i,h=1;for(let i=0;i<s;i+=1){let i=.5*h*e.I*e.I;if(this.jt(t,0,i)){t.Tt=h,t.dy=0;break}t.Tt=0,t.y+=i}}}));let s=this.S(F);s.forEach((t=>{let i=Math.sign(t.dy),s=Math.abs(t.dy+t.Ot);t.Ot=s%1*i;for(let h=0;h<s;h++){let s=i*e.I*10;if(this.jt(t,s,0)){t.Tt=i,t.dy=0;break}t.Tt=0,t.y+=s}}));let h=this.S(B);h.forEach((i=>{t&&void 0===t.Zt&&(t.Gt&&v(i.Ht,t.Xt)?(i.$t=.3,t.dy=-1040,p.play("jump0")):v(i.Ht,t.qt)&&(t.Zt=.8,t.dy=-640,t.dx=(0===t.dx?Math.sign(i.dx):-Math.sign(t.dx))*A*2.5,p.play("knock")))})),h.forEach((t=>{let i=s.filter((t=>!t.Kt)).find((i=>v(t.Ht,i.Ht)));i&&(0===t.Wt?t.remove():(t.Kt=.2,t.dx=1.2*i.dx,t.dy=-160,t.H(D,{name:"bullet",tag:"damage",duration:.4}),p.play("damage"+Math.floor(3*Math.random()))),i.Kt=!0)})),0!==this.bt&&(this.Vt=this.bt*Math.sin(2*Math.PI*.2*this.O),this.Vt+=this.bt*Math.random()*1),0!==this.Bt&&(this.kt=this.Bt*Math.cos(2*Math.PI*100*e.I),this.kt+=this.Bt*Math.random()),this.bt=x(this.bt,0,100*e.I),this.Bt=x(this.Bt,0,100*e.I)}K(t){t.U(-this.vt+this.Vt,-this.yt+this.kt)}Y(t){t.pop()}W(t){for(let i=0;i<this.w;i++)for(let s=0;s<this.t;s++){let h=this.o[s][i];t.V(h,8*i,8*s)}}}class b extends r{B;w=16;t=16;dx=0;dy=0;Lt=0;Ot=0;Jt=0;Tt=0;Yt=1;get Rt(){return 1}get St(){return 1}get zt(){return 1}get Ht(){let{x:t,y:i,w:s,t:h}=this;return{x:t-s/2,y:i-h/2,w:s,t:h}}K(t){t.U(this.x,this.y)}Y(t){t.pop()}update(){0!==this.dx&&(this.Yt=Math.sign(this.dx)),super.update()}}class B extends b{$t;Kt;Wt=3;X(){this.B=this.H(a,{name:"plus_char"}),this.dx=5}q(){this.Jt&&(this.dx=-1*this.Yt*A/2),void 0!==this.$t&&(this.$t=x(this.$t,0,e.I),0===this.$t&&(this.$t=void 0)),this.Kt?(this.B.rt("damage"),this.Kt=x(this.Kt,0,e.I),this.dx=x(this.dx,(this.Wt<1?1:-1)*Math.sign(this.dx)*A/2,200*e.I),this.B.ht=x(this.B.ht,1.2,2*e.I),this.B.st=x(this.B.st,.8,2*e.I),0===this.Kt&&(this.Kt=void 0,this.Wt-=1,this.dx=Math.sign(this.dx)*A/2)):void 0!==this.$t?(this.B.ht=x(this.B.ht,.8,1.8*e.I),this.B.st=x(this.B.st,1.2,1.6*e.I),this.B.rt("jumped")):(this.B.ht=x(this.B.ht,1,e.I),this.B.st=x(this.B.st,1,e.I),this.B.rt("idle"))}}class j extends b{X(){this.parent.H(B,{},this.x,this.y)}q(){this.parent.S(B).length<2&&e.N(1)&&this.parent.H(B,{},this.x,this.y)}}class D extends b{get Rt(){return 0}get St(){return 0}get data(){return this.R}get duration(){return this.data.duration??1}X(){let{name:t,tag:i}=this.data;this.B=this.H(a,{name:t,tag:i,duration:this.duration})}q(){if(this.O>=this.duration){if(this.data.ti?.(),this.data.ii){let[t,i]=this.data.ii;this.parent.H(t,i,this.x,this.y)}this.remove()}}}class E extends b{Ct=!1;It=!1;Ft;Nt;Zt;si;hi;ni=2;Pt=0;ei=this.ri;ai=this.y;get Xt(){return{x:this.Ht.x,y:this.Ht.y,w:1.2*this.w,t:this.t}}get qt(){return{x:this.Ht.x,y:this.Ht.y,w:.8*this.w,t:.7*this.t}}get oi(){return this.ai>this.y}get Gt(){return this.ai<this.y}get Rt(){return(0===this.dy?1:.8)*(this.Pt>0?.66:1)}get St(){return this.Pt>0?.36:1}get ri(){return this.Tt>0}X(){this.B=this.H(a,{name:"main_char"})}q(){e.N(1)&&(w=Math.min(1,w+.01)),void 0!==this.Zt&&(this.Zt=x(this.Zt,0,e.I),0===this.Zt&&(this.Zt=void 0));let t=o("ArrowLeft")||o("a"),i=o("ArrowRight")||o("d"),s=o("ArrowUp")||o("w"),h=o(" ")||o("x");if(this.It=t,this.Ct=i,t&&i||!t&&!i)this.dx=x(this.dx,0,70*e.I);else if(t){"skid"!==this.B.it&&this.dx>0&&this.dx<6&&(this.dx=0);let t=this.dx>0?40:30;this.dx=x(this.dx,-10,e.I*t)}else if(i){"skid"!==this.B.it&&this.dx<0&&this.dx>-6&&(this.dx=0);let t=this.dx<0?40:30;this.dx=x(this.dx,A,e.I*t)}if(s?void 0!==this.si&&(this.si+=e.I):void 0===this.si?this.si=0:this.si>0&&(this.si=-.3),void 0!==this.si&&this.si<0&&(this.si+=e.I,this.si>=0&&(this.si=void 0)),void 0!==this.si&&this.si>0&&(void 0!==this.hi?(this.dy=-800,this.si=void 0,this.ni=1,p.play("jump0")):this.ni>0&&(this.dy=-800,this.si=void 0,this.ni=0,p.play("jump"+(Math.random()<.3?"1":"2")))),this.ri?this.hi=0:this.ei&&(this.hi=.16),void 0!==this.hi&&this.hi>0&&(this.hi=x(this.hi,0,e.I),0===this.hi&&(this.hi=void 0)),void 0!==this.Zt?this.B.rt("knock"):void 0!==this.Ft?this.B.rt("ledge"):this.ri?0!==this.dx?(Math.abs(this.dx)>2&&(this.Yt<0&&i||this.Yt>0&&t)?this.B.rt("skid"):this.B.rt("run"),this.B.st=this.Yt):this.B.rt("idle"):this.oi?this.B.rt("jump"):this.B.rt("fall"),Math.sign(this.B.st)!==this.Yt&&(this.B.st*=-1),this.oi?(this.B.st=x(this.B.st,.8*this.Yt,.9*e.I),this.B.ht=x(this.B.ht,1.16,.9*e.I)):(this.B.st=x(this.B.st,this.Yt,e.I),this.B.ht=x(this.B.ht,1,e.I)),!this.Ft&&!this.Nt&&h&&0===this.Pt){let t=this.parent.H(D,{name:"bullet",tag:"flash"+(Math.random()<.4?"2":""),duration:.16});t.x=this.x+this.dx,t.y=this.y-8*Math.random(),t.B.st=this.Yt;let i=this.parent.H(F);i.x=this.x,i.y=t.y,i.dx=this.Yt*A*2.5,i.B.st=Math.sign(i.dx),i.li=i.x,i.ui=(0===this.dx?60:110)+30*Math.random(),this.Pt=.2}this.Pt=x(this.Pt,0,e.I),this.ei=this.ri,this.ai=this.y,this.B.x=-this.Pt*this.Yt*12}}class F extends b{w=12;t=12;li=0;ui=120;Kt=!1;get di(){return Math.abs(this.x-this.li)}get St(){return 0}get zt(){return.1}X(){this.B=this.H(a,{name:"bullet",duration:.1});let t=2*(.5-Math.random());this.dy=(1-w)*t*-12.8,p.play("bullet"+(Math.abs(t)>.5?"0":"1"))}q(){if(this.B.y+=this.dy*e.I,(this.di>this.ui||0!==this.Jt)&&(this.Kt=!0),this.Kt){let t=this.parent.H(D,{name:"bullet",tag:"hit",duration:.4});t.x=this.x,t.y=this.y,t.B.st=this.B.st,this.remove()}}}const C=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],I=t=>C.includes(t);!function(t){let i=function(t,i,s=!0){let h=document.createElement("canvas");s&&h.classList.add("pixelated");let e=h.getContext("2d");const r=()=>{h.width=t,h.height=i,e.imageSmoothingEnabled=!s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new n(h,e)}(320,180,!0);t.appendChild(i.canvas),y(i)}(document.getElementById("app"));
