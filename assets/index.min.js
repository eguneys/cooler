const t=""+new URL("out_0-CRUow3PL.png",import.meta.url).href,i=[{n:"Level_0",w:68,t:22,i:"AQQcAD04E0wUTBVMFkwXTBFQElATUBRQFVAWUBdQGFAAVA9UEFQRVBJUE1QUVBVUFlQXVBhUGVQaVENUAAQJAEM0PDhDOEM8Q0BDRENIQ0xDUAEIAwAxPD08JUQCBAoAADAANAA4PjgAPABAAEQASABMAFABAD8APTQxOCVAFEgVSBZIEkwQUBlQAVQCVANUBFQFVAZUB1QIVAlUClQLVAxUDVQOVBtUHFQdVB5UH1QgVCFUIlQjVCRUJVQmVCdUKFQpVCpUK1QsVC1ULlQvVDBUMVQyVDNUNFQ1VDZUN1Q4VDlUOlQ7VDxUPVQ+VD9UQFRBVEJUAAgEABw8MDw8PCREAggEAB08Mjw+PCZEAgAIAAAsPjQdODI4JkAXSBhMGlAAAAgAQzA8NBw4MDgkQBNIEUwPUBNMAQAFRBJMAQArJBFMAgAjUDZQ"}];function s(t){function i(t){function i(t){return[8*(t%1024),8*Math.floor(t/1024)]}let s=[],h=function(t){const i=atob(t),s=i.length,h=new Uint8Array(s);for(let e=0;e<s;e++)h[e]=i.charCodeAt(e);return new Uint16Array(h.buffer)}(t);for(let e=0;e<h.length;){let t=h[e];e++;let n=h[e];e++;let r=[...h.slice(e,e+n)];e+=n,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:h,t:e,i:n}=t;return{name:s,w:h,t:e,i:i(n)}}))}const h=new class{image;info;h;o;async load(){var h;this.image=await(h=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=h}))),this.info="bar\n\n0*0*idle\n1*1*end\n2*2*middle\n3*3*thumb\n\n4*160*96\n4*160*126\n4*0*160\n4*80*160\n\n\nbullet\n\n0*3*idle\n4*6*hit\n7*8*flash\n9*10*flash2\n\n0*80*220\n0*96*220\n0*112*220\n0*128*220\n0*144*220\n0*160*220\n0*176*220\n0*192*220\n0*208*220\n0*224*220\n0*240*220\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*160*160\n4*0*190\n4*80*190\n4*160*190\n4*0*220\n\n\nmain_char\n\n0*1*idle\n2*6*run\n7*10*jump\n11*14*fall\n15*17*ledge\n18*19*knock\n\n0*240*190\n0*240*160\n0*240*126\n0*240*96\n0*0*250\n0*16*250\n0*32*250\n0*48*250\n0*64*250\n0*80*250\n0*96*250\n0*112*250\n0*128*250\n0*144*250\n0*160*250\n0*176*250\n0*192*250\n0*208*250\n0*224*250\n0*240*250\n0*0*266\n\n\none_char\n\n0*1*idle\n2*4*hit\n\n0*16*266\n0*32*266\n0*48*266\n0*64*266\n0*80*266\n\n\nplus_char\n\n0*1*idle\n2*4*jumped\n\n0*96*266\n0*112*266\n0*128*266\n0*144*266\n0*160*266\n\n\ntiles\n\n0*0*idle\n\n3*0*0\n\n\ntwo_char\n\n0*3*idle\n4*5*damage\n6*8*split\n\n5*160*0\n5*192*0\n5*224*0\n5*160*32\n5*192*32\n5*224*32\n5*160*64\n5*192*64\n5*224*64".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,h]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,h]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:h}})),l:h.split(/\r?\n/).map((t=>{let[i,s,h,e,n,r,a,o]=function(t){let[i,s,h]=t,e=0,n=0,[r,a]=0===i?[16,16]:1===i?[32,16]:2===i?[80,80]:3===i?[160,160]:4===i?[80,30]:5===i?[32,32]:[0,0],[o,l]=[r,a];return[e,n,r,a,s,h,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:h,_:e,m:n,p:r,A:a,M:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],this.h=s(i),console.log(this.h)}};class e{constructor(t,i){this.canvas=t,this.v=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{v:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,h,e){let{v:n}=this;n.fillStyle=e,n.fillRect(t,i,s,h)}U(t,i){let{v:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{v:t}=this;t.restore()}V(t,i,s){let{fx:e,fy:n,m:r,p:a}=h.o,o=i-e,l=s-n,u=t%20*8,d=8*Math.floor(t/20);this.k(o,l,r+u,a+d,8,8)}B(t,i,s,h=1,e=1){let{fx:n,fy:r,m:a,p:o,A:l,M:u}=t.D,{F:d,j:c}=t,_=i-n-d,f=s-r-c;this.k(_,f,a,o,l,u,h,e)}k(t,i,s,e,n,r,a=1,o=1){let{v:l}=this,{image:u}=h;l.save();let d=n,c=r,_=d*Math.abs(a),f=c*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=_),o<0&&(i*=-1,i-=f),l.drawImage(u,s,e,d,c,Math.round(t),Math.round(i),Math.round(_),Math.round(f)),l.restore()}}const n={C:16,I:16,time:0,P(t,i=0){let{I:s,time:h}=this;return Math.floor((h-i-s)/t)<Math.floor((h-i)/t)}};class r{constructor(t,i){this.x=t,this.y=i}static N=t=>new r(Math.cos(t),Math.sin(t));static S=(t,i)=>new r(t,i);static get R(){return new r(0,0)}static get unit(){return new r(1,1)}get J(){return[this.x,this.y]}get L(){return new r(this.x/2,this.y/2)}get O(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.O)}get normalize(){return 0===this.length?r.R:this.scale(1/this.length)}get T(){return new r(-this.y,this.x)}get clone(){return new r(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}Z(t){return this.x*t.x+this.y*t.y}q(t){return this.x*t.y-this.y*t.x}G(t){return this.sub(t).length}scale(t){return new r(this.x*t,this.y*t)}add(t){return new r(this.x+t.x,this.y+t.y)}sub(t){return new r(this.x-t.x,this.y-t.y)}mul(t){return new r(this.x*t.x,this.y*t.y)}X(t){return r.N(this.angle+t)}}class a{constructor(t,i){this.$=t,this.r=i}static S=(t,i,s)=>new a(r.S(t,i),s);static get unit(){return a.S(0,0,1)}scale(t){return a.S(this.$.x,this.$.y,this.r*t)}}class o{constructor(t,i){this.x=t,this.y=i,this.H=[],this.K=[]}W;Y(t){return this.W=t,this}tt;H;K;parent;get position(){return new r(this.x,this.y)}it(t,i){this.K.push([t,i])}st(t){return this.H.filter((i=>i instanceof t))}ht(t){return this.H.find((i=>i instanceof t))}et(t,i,s,h){let e=new t(s,h);return e.parent=this,e.Y(i).init(),e}S(t,i={},s=0,h=s){let e=this.et(t,i,s,h);return this.H.push(e),e}remove(t){if(!t)return void this.parent?.remove(this);let i=this.H.indexOf(t);if(-1===i)throw"noscene rm";this.H.splice(i,1)}init(){return this.tt=0,this.nt(),this}update(){0===this.tt&&this.rt(),this.H.forEach((t=>t.update())),this.tt+=n.I,this.K=this.K.map((([t,i])=>(t-n.I<0&&i(),[t-n.I,i]))).filter((t=>t[0]>0)),this.ot()}draw(t){this.lt(t),this.H.forEach((i=>i.draw(t))),this.ut(t),this.dt(t)}nt(){}rt(){}ot(){}ut(t){}lt(t){}dt(t){}}class l extends o{get data(){return this.W}get info(){let t=h.info.find((t=>t.name===this.ct));if(!t)throw`nosprite ${this.ct}`;return t}get duration(){return this.data.duration??.4}get tag(){let t=this.info.tags.find((t=>t.name===this._t));if(!t)throw`notag ${this.ct} ${this._t}`;return t}get ct(){return this.data.name}get _t(){return this.data.tag||"idle"}x=0;y=0;ft=1;gt=1;wt(t,i){this.x=t,this.y=i}_current_frame=0;get D(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get xt(){return this.data.xt??"c"}get F(){if("tl"===this.xt)return 0;let{u:t}=this.D;return"c"===this.xt||"bc"===this.xt?t/2:0}get j(){if("tl"===this.xt)return 0;let{_:t}=this.D;return"c"===this.xt?t/2:"bc"===this.xt?t:0}At(t){this.data.tag=t,this._current_frame=0,this.Mt=0}Mt=0;ot(){let{from:t,to:i}=this.tag,{duration:s}=this,h=s/(i-t+1),e=i-t;this.Mt+=n.I,this.Mt>=h&&(this.Mt-=h,this._current_frame===e?this._current_frame=0:this._current_frame+=1)}ut(t){let{x:i,y:s,ft:h,gt:e}=this;t.B(this,i,s,h,e)}}const u=function(){let t=new Set;return document.addEventListener("keydown",(i=>(i=>{"ArrowUp"!==i.key&&"ArrowDown"!==i.key||i.preventDefault(),t.add(i.key)})(i))),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var d=function(){var t,i,s,h,e,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var h,e,n,a,l,u,d=o[t.vt[0]],c=t.vt[1],_=t.vt[3]/32,f=o[t.vt[4]],g=t.vt[5],m=t.vt[8]/32,p=t.vt[9],w=t.vt[10]*t.vt[10]*4,x=t.vt[11]*t.vt[11]*4,A=t.vt[12]*t.vt[12]*4,M=1/A,v=-t.vt[13]/16,y=t.vt[14],Q=s*2**(2-t.vt[15]),b=new Int32Array(w+x+A),U=0,V=0;for(h=0,e=0;h<w+x+A;h++,e++)e>=0&&(e-=Q,l=r(i+(15&(y=y>>8|(255&y)<<4))+t.vt[2]-128),u=r(i+(15&y)+t.vt[6]-128)*(1+8e-4*t.vt[7])),n=1,h<w?n=h/w:h>=w+x&&(n=(1-(n=(h-w-x)*M))*3**(v*n)),a=d(U+=l*n**_)*c,a+=f(V+=u*n**m)*g,p&&(a+=(2*Math.random()-1)*p),b[h]=80*a*n|0;return b},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.yt,s=0,h=n.Qt*n.bt*(i+1)*2,e=new Int32Array(h)},this.Ut=function(){var r,l,u,d,c,_,f,g,m,p,w,x,A,M,v=new Int32Array(h),y=t.Vt[s],Q=t.Qt,b=t.bt,U=0,V=0,k=!1,B=[];for(u=0;u<=i;++u)for(f=y.kt[u],d=0;d<b;++d){var D=f?y.c[f-1].f[d]:0;D&&(y.vt[D-1]=y.c[f-1].f[d+b]||0,D<17&&(B=[]));var F=o[y.vt[16]],E=y.vt[17]/512,j=2**(y.vt[18]-9)/Q,C=y.vt[19],I=y.vt[20],P=43.23529*y.vt[21]*3.141592/44100,N=1-y.vt[22]/255,S=1e-5*y.vt[23],R=y.vt[24]/32,J=y.vt[25]/512,L=6.283184*2**(y.vt[26]-9)/Q,O=y.vt[27]/255,z=y.vt[28]*Q&-2;for(w=(u*b+d)*Q,c=0;c<4;++c)if(_=f?y.c[f-1].n[d+c*b]:0){B[_]||(B[_]=a(y,_,Q));var T=B[_];for(l=0,r=2*w;l<T.length;l++,r+=2)v[r]+=T[l]}for(l=0;l<Q;l++)(p=v[g=2*(w+l)])||k?(x=P,C&&(x*=F(j*g)*E+.5),V+=(x=1.5*Math.sin(x))*(A=N*(p-V)-(U+=x*V)),p=3==I?V:1==I?A:U,S&&(p=(p*=S)<1?p>-1?n(.25*p):-1:1,p/=S),k=(p*=R)*p>1e-5,M=p*(1-(m=Math.sin(L*g)*J+.5)),p*=m):M=0,g>=z&&(M+=v[g-z+1]*O,p+=v[g-z]*O),v[g]=0|M,v[g+1]=0|p,e[g]+=0|M,e[g+1]+=0|p}return++s/t.Bt},this.Dt=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<h;r+=2)n[r>>1]=e[r]/65536;return i}};const c={Vt:[{vt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],kt:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{vt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],kt:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{vt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],kt:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],Qt:7350,bt:32,yt:22,Bt:3},_=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},h=[{name:"song",data:c}];return{Ut:()=>(h.forEach((i=>{let h=new d;h.init(i.data),function e(){if(1===h.Ut()){let e=h.Dt(t);((t,i)=>{s[t]=i})(i.name,e)}else setTimeout(e,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==h.length?setTimeout(i,100):t()}()}))),play:(h,e=!1)=>{const n=s[h];if(!n)return;let r=t.createBufferSource(),a=t.createGain();return r.buffer=n,r.connect(a),a.connect(i),r.loop=e,a.gain.value=.8,r.start(),()=>{r.stop()}}}}();function f(t,i){let s=i*i/(t*t);return s=s>1?1:Math.sqrt(s),t*s}class g{constructor(t){this.Ft=t,this.force=r.R,this.x=r.S(t.Et,t.jt),this.Et=this.x,this.Ct=r.R,this.It=this.Ft.Pt}force;x;Et;Ct;It;update(t,i){let{Ft:{Nt:s,St:h,Pt:e}}=this,{force:n,x:a,Et:o}=this,l=n.scale(1/h);l.x=f(l.x,e),l.y=f(l.y,e);let u=a.sub(o).scale(s*t/i).add(l.scale(t*(t+i)/2)),d=a,c=a.add(u);this.Et=d,this.x=c,this.Ct=u,this.force=r.R,this.It=e}Rt(t){let i=Math.min(this.It,t.length);this.It-=i,t=t.normalize.scale(i),this.force=this.force.add(t)}Jt(t){this.force=this.force.mul(t)}get position(){return this.x}get Lt(){return this.Ct}get heading(){let t=this.Lt.normalize;return 0===t.length?r.unit:t}get Ot(){return this.heading.T}get zt(){return this.Ft.zt}}class m{constructor(t,i){this.Tt=i,this.body=new g(t)}static Zt=t=>r.R;static qt=t=>i=>function(t,i,s){let h=t.sub(i),e=h.scale(h.length<200?1:-1).normalize;return h.T.normalize.add(e).scale(s/2)}(i.position,t,i.zt);static Gt=t=>i=>function(t,i,s){let h=r.R;return i.forEach((i=>{let s=t.sub(i);h=h.add(s.normalize.scale(1/(s.length||.1)))})),h.scale(15*s)}(i.position,t,i.zt);static Xt=(t,i=0)=>s=>function(t,i,s,h){return p(t,i.$,s,h,1.2*i.r)}(s.position,t,s.zt,i);static $t=(t,i=0,s=100)=>h=>p(h.position,t,h.zt,i,s);static Ht=(t,i=100)=>s=>function(t,i,s,h){let e=i.sub(t),n=e.length;if(n<20)return r.R;let a=s*(n/h),o=Math.min(a,s);return e.scale(o/n)}(s.position,t,s.zt,i);get position(){return this.body.position}body;Jt=r.unit;get Ft(){return this.body.Ft}set Ft(t){this.body.Ft=t}update(t,i){this.Tt.forEach((([t,i])=>{let s=t(this.body).sub(this.body.Lt).scale(this.Ft.Pt/this.Ft.zt);this.body.Rt(s.scale(i))})),this.body.Jt(this.Jt),this.body.update(t,i)}}function p(t,i,s,h,e){let n=t.sub(i);return n.length>e?r.R:(0===n.length&&(n=n.X(h)),n.normalize.scale(s))}function w(t,i,s=.1){return(1-s)*t+s*i}function x(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function A(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function M(t){let i;const s=h=>{i=new h(0,0),i.Y({g:t,go:s}),i.init()};s(y),function(t){let i;const s=h=>{n.C=n.I,n.I=Math.min(20,Math.max(16,i?h-i:16))/1e3,i=h,n.time+=n.I,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),i.draw(t)}))}class v extends o{Kt=!1;Wt;get data(){return this.W}get g(){return this.data.g}go(t){this.data.go(t)}update(){u("m")?this.Kt||(this.Kt=!0,this.Wt?(this.Wt(),this.Wt=void 0):this.Wt=_.play("song",!0)):this.Kt=!1,super.update()}}class y extends v{nt(){h.load().then((()=>{this.S(l,{name:"loading",tag:"audio",duration:1e3},160,90),_.Ut().then((()=>{this.go(Q)}))}))}}class Q extends v{map;Yt;nt(){this.Wt=_.play("song",!0),this.map=this.S(U),this.Yt=this.S(b)}}class b extends o{nt(){for(let h=0;h<3;h++){let t=this.S(l,{name:"bar"});t.x=80+80*h,t.y=15}let t=this.S(l,{name:"bar",tag:"end"});t.x=60,t.y=15;let i=this.S(l,{name:"bar",tag:"end"});i.x=260,i.y=15,i.ft=-1;let s=this.S(l,{name:"bar",tag:"middle"});s.x=160,s.y=15,this.ti=this.S(l,{name:"bar",tag:"thumb"}),this.ti.y=25}ti;width=0;ot(){this.ti.x=40+this.width/26*240}lt(t){t.fr(35,12,260,8,"red")}}class U extends o{get Yt(){return this.parent.Yt}w;t;o;ii=0;si=0;hi=0;ei=0;ni=0;ri=0;ai=0;oi=0;nt(){const t=h.h[0];this.w=t.w,this.t=t.t,this.o=Array(t.t);for(let i=0;i<t.t;i++)this.o[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:h}=t.i[i],e=s[0]/8,n=s[1]/8,r=h[1]/8*20+h[0]/8;399===r?this.S(I,{},s[0],s[1]):398===r?this.S(D,{},s[0],s[1]):397===r?this.S(B,{},s[0],s[1]):this.o[n][e]=r}}li(t,i,s){return!!this.ui(t,i,s)}ui(t,i,s){let{x:h,y:e,w:n,t:r}=t;return this.di(h-n/2+i,e-r/2+s,n,r)}di(t,i,s=1,h=1){let e=this.o[0].length,n=this.o.length,r=t/8,a=i/8,o=(t+s-1)/8,l=(i+h-1)/8;if(r<0||o>=e||a<0||l>=n)return!0;for(t=r;t<=o;t++)for(i=a;i<=l;i++)if(t=Math.floor(t),i=Math.floor(i),J(this.o[i][t]))return[8*t,8*i]}ot(){let t=this.ht(I);if(t){if(t&&void 0===t.ci){let i=this.li(t,0,4),s=this.ui(t,1,-8)?void 0:this.ui(t,1,0),h=this.ui(t,-1,-8)?void 0:this.ui(t,-1,0);i||(t._i&&Array.isArray(s)?(t.ci=.4,t.x=s[0],t.y=s[1]):t.fi&&Array.isArray(h)&&(t.ci=.4,t.x=h[0]+8,t.y=h[1]))}if(t&&void 0===t.ci&&void 0===t.gi){let i=this.ui(t,1,-8)?void 0:this.ui(t,1,0),s=this.ui(t,-1,-8)?void 0:this.ui(t,-1,0);t._i&&Array.isArray(i)?(t.gi=.16,t.x=i[0],t.y=i[1]-1):t.fi&&Array.isArray(s)&&(t.gi=-.16,t.x=s[0]+8,t.y=s[1]-1)}let i=this.ui(t,0,0);if(void 0!==t.ci&&(t.ci=x(t.ci,0,n.I),0===t.ci&&(t.ci=void 0,t.y=i[1]-8,t.dy=0)),void 0!==t.gi)t.gi=x(t.gi,0,n.I),0===t.gi&&(t.gi=void 0,t.y=i[1]-8,t.dy=0);else{let i=9;{let s=Math.sign(t.dy),h=Math.abs(t.dy+t.mi);t.mi=h%1*s;for(let e=0;e<h;e+=1){let h=.5*s*n.I*n.I*20;if(this.li(t,0,h)){t.pi=s,t.dy/=2;break}t.pi=0,t.y+=h;{let s=i,h=1;t.dy+=h*s*n.I}}}if(t.dy>-50){let s=2e3*i,h=1;for(let i=0;i<s;i+=1){let i=.5*h*n.I*n.I;if(this.li(t,0,i)){t.pi=h,t.dy=0;break}t.pi=0,t.y+=i}}let s=Math.sign(t.dx),h=Math.abs(t.dx+t.wi);t.wi=h%1*s;let e=0===t.dy?1:.8,r=t.xi>0?.66:1;for(let o=0;o<h;o++){let i=s*n.I*10*e*r;if(this.li(t,i,0)){t.Ai=s,t.dx=0;break}t.Ai=0,t.x+=i}this.hi<t.x-8-30&&(this.hi=t.x-8-30),this.hi>t.x+8+30&&(this.hi=t.x+8+30),this.ei<t.y-8-30&&(this.ei=t.y-8-30),this.ei>t.y+8+30&&(this.ei=t.y+8+30);let a=t.dx<0?-170:t.dx>0?-150:-160;this.ii=w(this.ii,this.hi+a),this.si=w(this.si,this.ei-90,.5),this.ii=Math.min(Math.max(0,this.ii),8*this.w-320)}t.xi>0&&(this.ai=-1,this.oi=-.2)}let i=this.st(P);if(t){let s=this.ht(C)?.position??r.R,h=this.st(j);h.forEach((t=>{let s=i.find((i=>A(t.Mi,i.Mi)));s&&(this.S(E,{name:"one_char",tag:"hit",duration:.8},t.x,t.y),t.remove(),s.yi=!0,this.Yt.width++)})),h.forEach((i=>{i.Qi([[m.Gt(h.filter((t=>t!==i)).map((t=>t.position))),.1],[m.Ht(s,t.position.y),.2],[m.Xt(a.S(t.position.x,t.position.y,10)),.1]])}))}if(t){let s=this.st(C);s.forEach((t=>{let s=i.find((i=>A(t.Mi,i.Mi)));if(s){if(0===t.bi){for(let i=0;i<2;i++)this.S(E,{name:"two_char",tag:"split",duration:.8,Ui:[j,{}]},t.x,t.y);t.remove()}else t.yi=.3;s.yi=!0}})),s.forEach((i=>{i.yi?(i.Qi([[m.Xt(a.S(t.x,t.y,200)),.7],[m.Zt,.3]]),i.Vi(i.ki)):(i.Qi([[m.Gt(s.filter((t=>t!==i)).map((t=>t.position))),.1],[m.Ht(t.position,8),.2],[m.Ht(r.S(Math.abs(Math.sin(.2*this.tt))*this.w*8,t.position.y),8),.2],[m.Xt(a.S(t.x,t.y,90)),.4]]),i.Vi(i.Bi))}))}i.forEach((t=>{let i=Math.sign(t.dx),s=Math.abs(t.dx+t.wi);t.wi=s%1*i;for(let h=0;h<s;h++){let s=i*n.I*10;if(this.li(t,s,0)){t.Ai=i,t.dx=0;break}t.Ai=0,t.x+=s}})),this.st(k).forEach((i=>{let s=Math.sign(i.dx),h=Math.abs(i.dx+i.wi);i.wi=h%1*s;for(let t=0;t<h;t++){let t=s*n.I*10;if(this.li(i,t,0)){i.Ai=s,i.dx=-i.dx;break}i.Ai=0,i.x+=t}t&&void 0===t.Di&&(t.Fi&&A(i.Mi,t.Ei)?(i.ji=.3,t.dy=-3200):A(i.Mi,t.Ci)&&(t.Di=.8,t.dy=-2e3,t.dx=10*(0===t.dx?Math.sign(i.dx):-Math.sign(t.dx))*2))})),0!==this.ai&&(this.ni=this.ai*Math.sin(2*Math.PI*.2*this.tt),this.ni+=this.ai*Math.random()*1),0!==this.oi&&(this.ri=this.oi*Math.cos(2*Math.PI*100*n.I),this.ri+=this.oi*Math.random()),this.ai=x(this.ai,0,100*n.I),this.oi=x(this.oi,0,100*n.I)}lt(t){t.U(-this.ii+this.ni,-this.si+this.ri)}dt(t){t.pop()}ut(t){for(let i=0;i<this.w;i++)for(let s=0;s<this.t;s++){let h=this.o[s][i];t.V(h,8*i,8*s)}}}class V extends o{B;w=16;t=16;dx=0;dy=0;wi=0;mi=0;Ai=0;pi=0;get Mi(){let{x:t,y:i,w:s,t:h}=this;return{x:t-s/2,y:i-h/2,w:s,t:h}}lt(t){t.U(this.x,this.y)}dt(t){t.pop()}}class k extends V{ji;nt(){this.B=this.S(l,{name:"plus_char"}),this.dx=5}ot(){void 0!==this.ji&&(this.ji=x(this.ji,0,n.I),0===this.ji&&(this.ji=void 0)),void 0!==this.ji?(this.B.gt=x(this.B.gt,.8,1.8*n.I),this.B.ft=x(this.B.ft,1.2,1.6*n.I),this.B.At("jumped")):(this.B.gt=x(this.B.gt,1,n.I),this.B.ft=x(this.B.ft,1,n.I),this.B.At("idle"))}}class B extends V{nt(){this.parent.S(k,{},this.x,this.y)}ot(){this.parent.st(k).length<2&&n.P(1)&&this.parent.S(k,{},this.x,this.y)}}class D extends V{nt(){this.parent.S(C,{},this.x,this.y)}ot(){this.parent.st(C).length<5&&n.P(1)&&this.parent.S(C,{},this.x,this.y)}}class F extends V{Ii=[[m.Zt,1]];Pi;Ni;init(){return this.Pi=new m(this.Ft,this.Ii),super.init()}Qi(t){this.Ii.length=0,this.Ii.push(...t)}Vi(t){this.Pi.Ft=t}update(){void 0===this.Ni?this.Pi.Jt=r.unit:this.Ni?this.Pi.Jt=r.S(1,0):this.Pi.Jt=r.S(0,1),this.Pi.update(n.I,n.C);let{x:t,y:i}=this.Pi.position;this.x=t,this.y=i,super.update()}}class E extends V{get data(){return this.W}get duration(){return this.data.duration??1}nt(){let{name:t,tag:i}=this.data;this.B=this.S(l,{name:t,tag:i,duration:this.duration})}ot(){if(this.tt>this.duration){if(this.data.Si?.(),this.data.Ui){let[t,i]=this.data.Ui;this.parent.S(t,i,this.x,this.y)}this.remove()}}}class j extends F{Ft={St:.002,Nt:.99,zt:400,Pt:280,Et:this.x,jt:this.y};nt(){this.B=this.S(l,{name:"one_char"})}}class C extends F{w=32;t=32;yi;bi=2;Bi={St:.02,Nt:.98,zt:300,Pt:180,Et:this.x,jt:this.y};ki={St:.001,Nt:.8,zt:5e3,Pt:2e3,Et:this.x,jt:this.y};Ft=this.Bi;nt(){this.B=this.S(l,{name:"two_char"}),this.Ni=!0}ot(){n.P(3)&&void 0!==this.Ni&&(this.Ni=!this.Ni),this.yi?(this.Ni=void 0,this.B.At("damage"),this.yi=x(this.yi,0,n.I),0===this.yi&&(this.Ni=!0,this.yi=void 0,this.bi-=1)):this.B.At("idle")}}class I extends V{_i=!1;fi=!1;ci;gi;Di;Ri;Ji;Li=2;xi=0;Oi=this.zi;Ti=this.y;get Ei(){return{x:this.Mi.x,y:this.Mi.y,w:1.2*this.w,t:this.t}}get Ci(){return{x:this.Mi.x,y:this.Mi.y,w:.8*this.w,t:.7*this.t}}get Zi(){return this.Ti>this.y}get Fi(){return this.Ti<this.y}qi=1;get zi(){return this.pi>0}nt(){this.B=this.S(l,{name:"main_char"})}ot(){void 0!==this.Di&&(this.Di=x(this.Di,0,n.I),0===this.Di&&(this.Di=void 0)),0!==this.dx&&(this.qi=Math.sign(this.dx));let t=u("ArrowLeft")||u("a"),i=u("ArrowRight")||u("d"),s=u("ArrowUp")||u("w"),h=u(" ")||u("x");if(this.fi=t,this._i=i,t){let t=this.dx>0?40:30;this.dx=x(this.dx,-10,n.I*t)}else if(i){let t=this.dx<0?40:30;this.dx=x(this.dx,10,n.I*t)}else this.dx=x(this.dx,0,66*n.I);if(s?void 0!==this.Ri&&(this.Ri+=n.I):void 0===this.Ri?this.Ri=0:this.Ri>0&&(this.Ri=-.3),void 0!==this.Ri&&this.Ri<0&&(this.Ri+=n.I,this.Ri>=0&&(this.Ri=void 0)),void 0!==this.Ri&&this.Ri>0&&(void 0!==this.Ji?(this.dy=-2e3,this.Ri=void 0,this.Li=1,_.play("jump")):this.Li>0&&(this.dy=-2e3,this.Ri=void 0,this.Li=0,_.play("djump"))),this.zi?this.Ji=0:this.Oi&&(this.Ji=.16),void 0!==this.Ji&&this.Ji>0&&(this.Ji=x(this.Ji,0,n.I),0===this.Ji&&(this.Ji=void 0)),void 0!==this.Di?this.B.At("knock"):void 0!==this.ci?this.B.At("ledge"):this.zi?0!==this.dx?(this.B.At("run"),this.B.ft=this.qi):this.B.At("idle"):this.Zi?this.B.At("jump"):this.B.At("fall"),Math.sign(this.B.ft)!==this.qi&&(this.B.ft*=-1),this.Zi?(this.B.ft=x(this.B.ft,.8*this.qi,.9*n.I),this.B.gt=x(this.B.gt,1.16,.9*n.I)):(this.B.ft=x(this.B.ft,this.qi,n.I),this.B.gt=x(this.B.gt,1,n.I)),!this.ci&&!this.gi&&h&&0===this.xi){let t=this.parent.S(N);t.x=this.x+this.dx,t.y=this.y-8*Math.random(),t.B.ft=this.qi;let i=this.parent.S(P);i.x=this.x,i.y=t.y,i.dx=10*this.qi*2.5,i.B.ft=Math.sign(i.dx),i.Gi=i.x,i.Xi=(0===this.dx?60:110)+30*Math.random(),this.xi=.2}this.xi=x(this.xi,0,n.I),this.Oi=this.zi,this.Ti=this.y,this.B.x=-this.xi*this.qi*12}}class P extends V{w=12;t=12;Gi=0;Xi=120;yi=!1;get G(){return Math.abs(this.x-this.Gi)}nt(){this.B=this.S(l,{name:"bullet",duration:.1}),this.dy=40*(.5-Math.random())}ot(){if(this.B.y+=this.dy*n.I,(this.G>this.Xi||0!==this.Ai)&&(this.yi=!0),this.yi){let t=this.parent.S(S,{name:"bullet",tag:"hit"});t.x=this.x,t.y=this.y,t.B.ft=this.B.ft,this.remove()}}}class N extends V{nt(){this.B=this.S(l,{name:"bullet",tag:"flash"+(Math.random()<.4?"2":""),duration:.16})}ot(){this.tt>=.16&&this.remove()}}class S extends V{nt(){this.B=this.S(l,{name:"bullet",tag:"hit",duration:.4})}ot(){this.tt>=.4&&this.remove()}}const R=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],J=t=>R.includes(t);!function(t){let i=function(t,i,s=!0){let h=document.createElement("canvas");s&&h.classList.add("pixelated");let n=h.getContext("2d");const r=()=>{h.width=t,h.height=i,n.imageSmoothingEnabled=!s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new e(h,n)}(320,180,!0);t.appendChild(i.canvas),M(i)}(document.getElementById("app"));
