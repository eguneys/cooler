const t=""+new URL("out_0-DhG3cFTH.png",import.meta.url).href,i=[{n:"Level_0",y:-72,w:171,t:32,i:"AQQFABZ8HXwefCV8JnwBDAMAF3wffCd8AAwDABV8HHwkfAEIAgCLWJNYAgQCAJxEUHwBAEoAFngdeB54JXgmeAB8AXwCfAN8BHwFfAZ8B3wIfAl8CnwLfAx8DXwOfA98EHwRfBJ8E3wUfBh8GXwafBt8IHwhfCJ8I3wofCl8KnwrfCx8LXwufC98MHwxfDJ8M3w0fDV8Nnw3fDh8OXw6fDt8PHw9fD58P3xAfEF8QnxDfER8RXxGfEd8SHxJfEp8S3xMfE18TnxPfAAIAgCKOJM4AggCAIs4lDgCAAUAizSUNBd4H3gneAAABQCKNJM0FXgceCR4BAgRAFQ4VDxUQJxAVERUSJxIVEycTJxQRFScVERYUGxQcFB0UHgEDAIAUFREXAQEBABsTIJUi1STVAQATwCmLKcsqCypLKosojCjMKQwVTRWNFc0oDSdPJtERVBGUEdQSFBJUEpQS1BMUE1QTlBPUFVQVlBXUFhQWVBaUFtQXFBdUF5QX1BgUGFQYlBjUGRQZVBmUGdQaFBpUGpQa1B6WHtYg1iEWIVYhliHWIhYiViKWIxYjViOWI9YkFiRWJJYlFiVWJZYl1iYWJlYmlibWHZcd1x4XFFoUmhTaAUAAwBYNHxYVGgDAAIAmkR1XAIQAgBUUIJYAxAHAKUwoTSfOJ48bFCcWHlcAwwBAFBQAgwJAKUsoTBUNJ80njicPERQeVhQaAUEAQAQeAUIBABaTIRUl1RDdA=="}];function s(t){function i(t){function i(t){return[8*(t%1024),8*Math.floor(t/1024)]}let s=[],h=function(t){const i=atob(t),s=i.length,h=new Uint8Array(s);for(let e=0;e<s;e++)h[e]=i.charCodeAt(e);return new Uint16Array(h.buffer)}(t);for(let e=0;e<h.length;){let t=h[e];e++;let n=h[e];e++;let r=[...h.slice(e,e+n)];e+=n,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,y:h,w:e,t:n,i:r}=t;return{name:s,y:h,w:e,t:n,i:i(r)}}))}const h=new class{image;info;h;o;async load(){var h;this.image=await(h=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=h}))),this.info="bullet\n\n0*3*idle\n4*6*hit\n7*8*flash\n9*10*flash2\n11*14*damage\n\n0*80*80\n0*96*80\n0*112*80\n0*128*80\n0*144*80\n0*128*30\n0*144*30\n0*128*0\n0*144*0\n0*48*60\n0*64*60\n0*80*60\n0*96*60\n0*112*60\n0*128*60\n\n\nfx\n\n0*1*djump\n\n0*144*60\n0*0*110\n\n\nloading\n\n0*0*audio\n1*2*input\n\n4*48*0\n4*48*30\n4*0*80\n\n\nmain_char\n\n0*1*idle\n2*6*run\n7*10*jump\n11*14*fall\n15*17*ledge\n18*19*knock\n20*21*skid\n22*23*die\n24*24*dead\n\n0*16*110\n0*32*110\n0*48*110\n0*64*110\n0*80*110\n0*96*110\n0*112*110\n0*128*110\n0*144*110\n0*0*126\n0*16*126\n0*32*126\n0*48*126\n0*64*126\n0*80*126\n0*96*126\n0*112*126\n0*128*126\n0*144*126\n0*0*142\n0*16*142\n0*32*142\n0*48*142\n0*64*142\n0*80*142\n\n\nplus_char\n\n0*1*idle\n2*4*jumped\n5*6*damage\n7*9*sleep\n10*11*cover\n12*14*cover_hit\n15*16*ear\n17*19*wgro\n\n0*96*142\n0*112*142\n0*128*142\n0*144*142\n0*0*158\n0*16*158\n0*32*158\n0*48*158\n0*64*158\n0*80*158\n0*96*158\n0*112*158\n0*128*158\n0*144*158\n0*0*174\n0*16*174\n0*32*174\n0*48*174\n0*64*174\n0*80*174\n\n\ntiles\n\n0*0*idle\n\n3*0*0\n\n\nwgrofire\n\n0*2*idle\n\n0*96*174\n0*112*174\n0*128*174".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,h]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,h]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:h}})),l:h.split(/\r?\n/).map((t=>{let[i,s,h,e,n,r,a,o]=function(t){let[i,s,h]=t,e=0,n=0,[r,a]=0===i?[16,16]:1===i?[32,16]:2===i?[80,80]:3===i?[160,160]:4===i?[80,30]:5===i?[32,32]:[0,0],[o,l]=[r,a];return[e,n,r,a,s,h,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:h,_:e,m:n,p:r,A:a,M:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],this.h=s(i)}v(t){return this.h.filter((i=>i.y===128*t))}};class e{constructor(t,i){this.canvas=t,this.B=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{B:t}=this;t.clearRect(0,0,this.width,this.height)}U({x:t,y:i,w:s,t:h}){this.fr(t,i,s,h,"red")}fr(t,i,s,h,e){let{B:n}=this;n.fillStyle=e,n.fillRect(t,i,s,h)}k(t,i){let{B:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{B:t}=this;t.restore()}F(t,i,s){let{fx:e,fy:n,m:r,p:a}=h.o,o=i-e,l=s-n,u=t%6*8,d=8*Math.floor(t/6);this.I(o,l,r+u,a+d,8,8)}J(t,i,s,h=1,e=1){let{fx:n,fy:r,m:a,p:o,A:l,M:u}=t.j,{C:d,V:f}=t,c=i-n-d,_=s-r-f;this.I(c,_,a,o,l,u,h,e)}I(t,i,s,e,n,r,a=1,o=1){let{B:l}=this,{image:u}=h;l.save();let d=n,f=r,c=d*Math.abs(a),_=f*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=c),o<0&&(i*=-1,i-=_),l.drawImage(u,s,e,d,f,Math.round(t),Math.round(i),Math.round(c),Math.round(_)),l.restore()}}const n={D:16,H:16,time:0,R:0,X(t,i=0){let{H:s,time:h}=this;return Math.floor((h-i-s)/t)<Math.floor((h-i)/t)}};class r{constructor(t,i){this.x=t,this.y=i,this.Y=[],this.T=[]}W;L(t){return this.W=t,this}S;Y;T;parent;get position(){return[this.x,this.y]}G(t,i){this.T.push([t,i])}N(t){return this.Y.filter((i=>i instanceof t))}P(t){return this.Y.find((i=>i instanceof t))}K(t,i,s,h){let e=new t(s,h);return e.parent=this,e.L(i).init(),e}O(t,i={},s=0,h=s){let e=this.K(t,i,s,h);return this.Y.push(e),e}remove(t){if(!t)return void this.parent?.remove(this);let i=this.Y.indexOf(t);if(-1===i)throw"noscene rm";this.Y.splice(i,1)}init(){return this.S=0,this.Z(),this}update(){0===this.S&&this.q(),this.Y.forEach((t=>t.update())),this.S+=n.H,this.T=this.T.map((([t,i])=>(t-n.H<0&&i(),[t-n.H,i]))).filter((t=>t[0]>0)),this.$()}visible=!0;draw(t){this.visible&&(this.tt(t),this.Y.forEach((i=>i.draw(t))),this.it(t),this.st(t))}Z(){}q(){}$(){}it(t){}tt(t){}st(t){}}class a extends r{get data(){return this.W}get info(){let t=h.info.find((t=>t.name===this.ht));if(!t)throw`nosprite ${this.ht}`;return t}get duration(){return this.data.duration??.4}get tag(){let t=this.info.tags.find((t=>t.name===this.et));if(!t)throw`notag ${this.ht} ${this.et}`;return t}get ht(){return this.data.name}get et(){return this.data.tag||"idle"}x=0;y=0;nt=1;rt=1;ot(t,i){this.x=t,this.y=i}_current_frame=0;get j(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get lt(){return this.data.lt??"c"}get C(){if("tl"===this.lt)return 0;let{u:t}=this.j;return"c"===this.lt||"bc"===this.lt?t/2:0}get V(){if("tl"===this.lt)return 0;let{_:t}=this.j;return"c"===this.lt?t/2:"bc"===this.lt?t:0}ut(t){this.data.tag!==t&&(this.data.tag=t,this._current_frame=0,this.dt=0)}dt=0;$(){let{from:t,to:i}=this.tag,{duration:s}=this,h=s/(i-t+1),e=i-t;this.dt+=n.H,this.dt>=h&&(this.dt-=h,this._current_frame===e?this._current_frame=0:this._current_frame+=1)}it(t){let{x:i,y:s,nt:h,rt:e}=this;t.J(this,i,s,h,e)}}const o=function(){let t=new Set;return document.addEventListener("keydown",(i=>(i=>{"ArrowUp"!==i.key&&"ArrowDown"!==i.key||i.preventDefault(),t.add(i.key)})(i))),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var l=function(){var t,i,s,h,e,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var h,e,n,a,l,u,d=o[t.ft[0]],f=t.ft[1],c=t.ft[3]/32,_=o[t.ft[4]],g=t.ft[5],m=t.ft[8]/32,w=t.ft[9],p=t.ft[10]*t.ft[10]*4,x=t.ft[11]*t.ft[11]*4,A=t.ft[12]*t.ft[12]*4,M=1/A,y=-t.ft[13]/16,v=t.ft[14],B=s*2**(2-t.ft[15]),U=new Int32Array(p+x+A),b=0,Q=0;for(h=0,e=0;h<p+x+A;h++,e++)e>=0&&(e-=B,l=r(i+(15&(v=v>>8|(255&v)<<4))+t.ft[2]-128),u=r(i+(15&v)+t.ft[6]-128)*(1+8e-4*t.ft[7])),n=1,h<p?n=h/p:h>=p+x&&(n=(1-(n=(h-p-x)*M))*3**(y*n)),a=d(b+=l*n**c)*f,a+=_(Q+=u*n**m)*g,w&&(a+=(2*Math.random()-1)*w),U[h]=80*a*n|0;return U},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.ct,s=0,h=n._t*n.gt*(i+1)*2,e=new Int32Array(h)},this.wt=function(){var r,l,u,d,f,c,_,g,m,w,p,x,A,M,y=new Int32Array(h),v=t.xt[s],B=t._t,U=t.gt,b=0,Q=0,k=!1,F=[];for(u=0;u<=i;++u)for(_=v.At[u],d=0;d<U;++d){var I=_?v.c[_-1].f[d]:0;I&&(v.ft[I-1]=v.c[_-1].f[d+U]||0,I<17&&(F=[]));var J=o[v.ft[16]],j=v.ft[17]/512,E=2**(v.ft[18]-9)/B,C=v.ft[19],V=v.ft[20],D=43.23529*v.ft[21]*3.141592/44100,H=1-v.ft[22]/255,R=1e-5*v.ft[23],X=v.ft[24]/32,Y=v.ft[25]/512,T=6.283184*2**(v.ft[26]-9)/B,W=v.ft[27]/255,L=v.ft[28]*B&-2;for(p=(u*U+d)*B,f=0;f<4;++f)if(c=_?v.c[_-1].n[d+f*U]:0){F[c]||(F[c]=a(v,c,B));var S=F[c];for(l=0,r=2*p;l<S.length;l++,r+=2)y[r]+=S[l]}for(l=0;l<B;l++)(w=y[g=2*(p+l)])||k?(x=D,C&&(x*=J(E*g)*j+.5),Q+=(x=1.5*Math.sin(x))*(A=H*(w-Q)-(b+=x*Q)),w=3==V?Q:1==V?A:b,R&&(w=(w*=R)<1?w>-1?n(.25*w):-1:1,w/=R),k=(w*=X)*w>1e-5,M=w*(1-(m=Math.sin(T*g)*Y+.5)),w*=m):M=0,g>=L&&(M+=y[g-L+1]*W,w+=y[g-L]*W),y[g]=0|M,y[g+1]=0|w,e[g]+=0|M,e[g+1]+=0|w}return++s/t.Mt},this.yt=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<h;r+=2)n[r>>1]=e[r]/65536;return i}};const u=(t,i,s)=>({ft:t,At:i,c:s}),d=(t,i)=>i.map((i=>({xt:[u(t,[1],[{n:[i],f:[]}])],_t:5513,gt:32,ct:0,Mt:1}))),f={xt:[{ft:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],At:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{ft:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],At:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{ft:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],At:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],_t:7350,gt:32,ct:22,Mt:3},c=d([3,63,128,36,0,166,112,181,25,3,4,4,67,32,156,1,0,195,6,0,3,51,186,127,212,0,2,29,3],[135,125]),_=d([1,63,104,51,1,140,104,0,47,49,11,24,79,144,108,5,0,195,6,0,2,64,92,174,124,19,4,56,3],[149,158,150]),g=d([1,63,130,0,0,87,130,0,0,12,8,15,40,144,104,5,0,195,6,0,2,64,92,174,124,19,4,63,2],[135,137,139]),m=d([1,206,96,20,3,204,104,23,23,11,27,49,72,104,51,5,1,231,13,0,2,38,157,51,32,4,4,119,2],[139]),w=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},h=[{name:"song",data:f},{name:"bullet0",data:c[0]},{name:"bullet1",data:c[1]},{name:"damage0",data:_[0]},{name:"damage1",data:_[1]},{name:"damage2",data:_[2]},{name:"jump0",data:g[0]},{name:"jump1",data:g[1]},{name:"jump2",data:g[2]},{name:"knock",data:m[0]}];return{wt:()=>(h.forEach((i=>{let h=new l;h.init(i.data),function e(){if(1===h.wt()){let e=h.yt(t);((t,i)=>{s[t]=i})(i.name,e)}else setTimeout(e,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==h.length?setTimeout(i,100):t()}()}))),play:(h,e=!1)=>{const n=s[h];if(!n)return;let r=t.createBufferSource(),a=t.createGain();return r.buffer=n,r.connect(a),a.connect(i),r.loop=e,a.gain.value=.8,r.start(),()=>{r.stop()}}}}();const p=10;let x=.2;function A(t,i,s=.1){return(1-s)*t+s*i}function M(t,i,s=n.H){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function y(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function v(t){let i;const s=h=>{i?.vt?.(),i=new h(0,0),i.L({g:t,go:s}),i.init()};s(U),function(t){let i;const s=h=>{n.D=n.H,n.H=Math.min(20,Math.max(16,i?h-i:16))/1e3,n.R>0&&(n.R-=n.H,n.H*=.5),i=h,n.time+=n.H,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),i.draw(t)}))}class B extends r{Bt=!1;vt;get data(){return this.W}get g(){return this.data.g}go(t){this.data.go(t)}update(){o("m")?this.Bt||(this.Bt=!0,this.vt?(this.vt(),this.vt=void 0):this.vt=w.play("song",!0)):this.Bt=!1,super.update()}}class U extends B{Z(){h.load().then((()=>{this.O(a,{name:"loading",tag:"audio",duration:1e3},160,90),w.wt().then((()=>{this.go(b)}))}))}}class b extends B{map;Z(){this.vt=w.play("song",!0),this.map=this.O(Q)}$(){this.map.P(E).Ut>3&&this.go(b)}}class Q extends r{w;t;o;bt=0;Qt=0;kt=0;Ft=0;It=0;Jt=0;jt=0;Et=0;Z(){const t=h.h[0];this.w=t.w,this.t=t.t,this.o=Array(t.t);for(let i=0;i<t.t;i++)this.o[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:h}=t.i[i],e=s[0]/8,n=s[1]/8,r=h[1]/8*6+h[0]/8;11===r?this.O(E,{},s[0],s[1]):17===r?this.O(F,{},s[0],s[1]):this.o[n][e]=r}}Ct(t,i,s){return!!this.Vt(t,i,s)}Vt(t,i,s){let{x:h,y:e,w:n,t:r}=t;return this.Dt(h-n/2+i,e-r/2+s,n,r)}Dt(t,i,s=1,h=1){let e=this.o[0].length,n=this.o.length,r=t/8,a=i/8,o=(t+s-1)/8,l=(i+h-1)/8;if(r<0||o>=e||a<0||l>=n)return!0;for(t=r;t<=o;t++)for(i=a;i<=l;i++)if(t=Math.floor(t),i=Math.floor(i),D(this.o[i][t]))return[8*t,8*i]}$(){let t=this.P(E);if(0===t.Ht){let i=this.Ct(t,0,4),s=this.Vt(t,1,-8)?void 0:this.Vt(t,1,0),h=this.Vt(t,-1,-8)?void 0:this.Vt(t,-1,0);i||(t.Rt&&Array.isArray(s)?(t.Ht=.4,t.x=s[0],t.y=s[1]):t.Xt&&Array.isArray(h)&&(t.Ht=.4,t.x=h[0]+8,t.y=h[1]))}if(0===t.Ht&&0===t.Yt){let i=this.Vt(t,1,-8)?void 0:this.Vt(t,1,0),s=this.Vt(t,-1,-8)?void 0:this.Vt(t,-1,0);t.Rt&&Array.isArray(i)?(t.Yt=.13,t.x=i[0],t.y=i[1]-1):t.Xt&&Array.isArray(s)&&(t.Yt=-.13,t.x=s[0]+8,t.y=s[1]-1)}let i=this.Vt(t,0,0);t.Ht&&(t.Ht=M(t.Ht,0),0===t.Ht&&(t.y=i[1]-8,t.dy=0)),t.Yt&&(t.Yt=M(t.Yt,0),0===t.Yt&&(t.y=i[1]-8,t.dy=0)),t.Tt>0&&(this.jt=-1,this.Et=-.2),this.kt<t.x-8-30&&(this.kt=t.x-8-30),this.kt>t.x+8+30&&(this.kt=t.x+8+30),this.Ft<t.y-8-30&&(this.Ft=t.y-8-30),this.Ft>t.y+8+30&&(this.Ft=t.y+8+30);let s=t.dx<0?-170:t.dx>0?-150:-160;this.bt=A(this.bt,this.kt+s),this.Qt=A(this.Qt,this.Ft-90,.5),this.bt=Math.min(Math.max(0,this.bt),8*this.w-320),this.N(k).forEach((t=>{{let i=Math.sign(t.dx),s=Math.abs(t.dx+t.Wt);t.Wt=s%1*i;let h=t.Lt;for(let e=0;e<s;e++){let s=i*n.H*10*h;if(this.Ct(t,s,0)){t.St=i,t.dx=0;break}t.St=0,t.x+=s}}{let i=9.8;{let s=Math.sign(t.dy),h=Math.abs(t.dy+t.Gt);t.Gt=h%1*s;for(let e=0;e<h;e+=1){let h=.5*s*n.H*n.H*80;if(this.Ct(t,0,h)){t.Nt=s,t.dy/=2;break}{t.Nt=0,t.y+=h;let s=t.Pt;t.dy=M(t.dy,0,n.H*i*s)}}}let s=t.Kt;if(t.dy>-50){let h=2800*i*s,e=1;for(let i=0;i<h;i+=1){let i=.5*e*n.H*n.H;if(this.Ct(t,0,i)){t.Nt=e,t.dy=0;break}t.Nt=0,t.y+=i}}}}));let h=this.N(F);h.forEach((i=>{t.Ot||t.Zt||(t.zt&&y(i.qt,t.$t)&&(i.ti=.3,t.dy=-1040,w.play("jump0"),i.dy=-240),i.ii&&(y(i.si,t.qt)&&(i.hi=.3),y(i.ei,t.qt)&&(i.ni=.2)))}));let e=this.N(J);if(!t.Ot&&!t.Zt){let i=!1;Math.floor(t.y)===8*this.t-t.t/2?i=!0:e.forEach((s=>{y(s.qt,t.ri)&&(i=!0)})),i&&(n.R=2.2,t.Zt=2.2,t.dy=1.1*-800,t.dx=-1*t.ai*p*3)}let r=this.N(C);h.forEach((t=>{let i=r.filter((t=>!t.oi)).find((i=>y(t.qt,i.qt)));i&&(0===t.li&&(t.oi=.2,t.hi>0&&0===t.ui||(t.dx=1.2*i.dx,t.dy=-160,w.play("damage"+Math.floor(3*Math.random())),t.O(j,{name:"bullet",tag:"damage",duration:.4}))),i.oi=!0)})),0!==this.jt&&(this.It=this.jt*Math.sin(2*Math.PI*.2*this.S),this.It+=this.jt*Math.random()*1),0!==this.Et&&(this.Jt=this.Et*Math.cos(2*Math.PI*100*n.H),this.Jt+=this.Et*Math.random()),this.jt=M(this.jt,0,100*n.H),this.Et=M(this.Et,0,100*n.H)}tt(t){t.k(-this.bt+this.It,-this.Qt+this.Jt)}st(t){t.pop()}it(t){for(let i=0;i<this.w;i++)for(let s=0;s<this.t;s++){let h=this.o[s][i];t.F(h,8*i,8*s)}}}class k extends r{J;w=16;t=16;dx=0;dy=0;Wt=0;Gt=0;St=0;Nt=0;ai=1;get Lt(){return 1}get Kt(){return 1}get Pt(){return 1}get qt(){let{x:t,y:i,w:s,t:h}=this;return{x:t-s/2,y:i-h/2,w:s,t:h}}tt(t){t.k(this.x,this.y)}st(t){t.pop()}update(){0!==this.dx&&(this.ai=Math.sign(this.dx)),super.update()}}class F extends k{li=0;ti=0;oi=0;hi=0;ni=0;di=0;fi=4;ci=.6;ui=0;get ei(){return{x:this.ai<0?this.x+8:this.x-50-8,y:this.y,w:50,t:4}}get si(){return{x:this.ai<0?this.x-70-8:this.x+8,y:this.y,w:70,t:4}}get ii(){return this.oi+this.ti+this.hi+this.ni===0}Z(){this.J=this.O(a,{name:"plus_char"})}$(){if(this.St&&(this.ai=-1*this.ai),this.ti&&(this.ti=M(this.ti,0)),this.li)this.li=M(this.li,0),this.dx=0,this.J.ut("sleep");else if(this.oi)this.oi=M(this.oi,0),this.hi>0&&0===this.ui?(this.dx=M(this.dx,0,200*n.H),this.J.ut("cover_hit"),this.J.x=this.oi*this.ai*-1*12):(this.dx=M(this.dx,(this.fi<1?this.ai:-this.ai)*p*.58,200*n.H),this.J.ut("damage"),this.J.rt=M(this.J.rt,1.2,2*n.H),this.J.nt=M(this.J.nt,.8,2*n.H),0===this.oi&&(this.fi-=1,this.fi<0&&(this.fi=4,this.li=10)));else if(this.ti)this.J.rt=M(this.J.rt,.8,1.8*n.H),this.J.nt=M(this.J.nt,1.2,1.6*n.H),this.J.ut("jumped");else if(this.hi){if(this.hi=M(this.hi,0),this.dx=M(this.dx,0,8*n.H),this.ci>0)this.ci=M(this.ci,0);else{this.ui=1,this.ci=1.6+Math.random(),this.parent.O(I,{},this.x,this.y).dx=this.ai}this.ui?(this.ui=M(this.ui,0),this.J.ut("wgro")):this.J.ut("cover")}else this.ni?(this.ni=M(this.ni,0),this.dx=M(this.dx,0,8*n.H),this.J.ut("ear"),0===this.ni&&(this.ai=-1*this.ai)):this.di?this.di=M(this.di,0):(this.dx=this.ai*p*.58,this.J.ut("idle"));this.oi&&this.ti||(this.J.rt=M(this.J.rt,1),this.J.nt=M(this.J.nt,1))}}class I extends k{_i=0;gi=.16;$(){if(this.gi>0&&(this.gi=M(this.gi,0)),0===this.gi){this.gi=.16,this.parent.O(J,{},this.x+this._i,this.y-16).dy=-144,this._i+=8*this.ai}this.S>2.1&&this.remove()}}class J extends k{Z(){this.J=this.O(a,{name:"wgrofire",duration:.7})}$(){this.S>.7&&this.remove()}}class j extends k{get Lt(){return 0}get Kt(){return 0}get data(){return this.W}get duration(){return this.data.duration??1}Z(){let{name:t,tag:i}=this.data;this.J=this.O(a,{name:t,tag:i,duration:this.duration}),this.J.nt=this.data.scale??1}$(){if(this.S>=this.duration){if(this.data.mi?.(),this.data.wi){let[t,i]=this.data.wi;this.parent.O(t,i,this.x,this.y)}this.remove()}}}class E extends k{Rt=!1;Xt=!1;Ht=0;Yt=0;Zt=0;Ut=-1;pi;xi;Ai=2;Tt=0;fi=0;Mi=this.yi;Bi=this.y;get $t(){return{x:this.qt.x,y:this.qt.y,w:1.2*this.w,t:this.t}}get ri(){return{x:this.qt.x,y:this.qt.y,w:.8*this.w,t:.7*this.t}}get Ui(){return this.Bi>this.y}get zt(){return this.Bi<this.y}get Lt(){return(0===this.dy?1:.8)*(this.Tt>0?.66:1)*(this.Zt?1.2:1)}get Kt(){return(this.Tt>0?.36:1)*(this.Zt?.4:1)}get yi(){return this.Nt>0}get Ot(){return this.Ut>=0}Z(){this.J=this.O(a,{name:"main_char"})}$(){n.X(1)&&(x=Math.min(1,x+.01)),this.Zt&&(this.Zt=M(this.Zt,0),0===this.Zt&&0===this.fi&&(this.Ut=0)),this.Ut>=0&&(this.Ut+=n.H);let t=o("ArrowLeft")||o("a"),i=o("ArrowRight")||o("d"),s=o("ArrowUp")||o("w"),h=o(" ")||o("x");if((this.Ot||this.Zt&&(0===this.fi||this.Zt>1.8))&&(t=!1,i=!1,s=!1,h=!1),this.Xt=t,this.Rt=i,t&&i||!t&&!i)this.dx=M(this.dx,0,70*n.H);else if(t){"skid"!==this.J.et&&this.dx>0&&this.dx<6&&(this.dx=0);let t=this.dx>0?40:30;this.dx=M(this.dx,-10,n.H*t)}else if(i){"skid"!==this.J.et&&this.dx<0&&this.dx>-6&&(this.dx=0);let t=this.dx<0?40:30;this.dx=M(this.dx,p,n.H*t)}if(s?void 0!==this.pi&&(this.pi+=n.H):void 0===this.pi?this.pi=0:this.pi>0&&(this.pi=-.16),void 0!==this.pi&&this.pi<0&&(this.pi+=n.H,this.pi>=0&&(this.pi=void 0)),this.yi?this.xi=0:-1!==this.xi&&this.Mi&&(this.xi=.16),void 0!==this.pi&&this.pi>0&&(void 0!==this.xi&&this.xi>=0?(this.dy=-800,this.pi=void 0,this.xi=-1,this.Ai=1,w.play("jump0")):this.Ai>0&&(this.dy=-640,this.pi=void 0,this.Ai=0,w.play("jump"+(Math.random()<.3?"1":"2")),this.parent.O(j,{name:"fx",tag:"djump",duration:.3},this.x,this.y+5))),void 0!==this.xi&&this.xi>0&&(this.xi=M(this.xi,0),0===this.xi&&(this.xi=void 0)),this.Ot?this.J.ut("dead"):this.Zt?0===this.fi?this.J.ut("die"):(this.J.ut("knock"),this.visible=this.Zt%.26<.1):this.Ht?this.J.ut("ledge"):this.yi?0!==this.dx?(Math.abs(this.dx)>2&&(this.ai<0&&i||this.ai>0&&t)?this.J.ut("skid"):this.J.ut("run"),this.J.nt=this.ai):this.J.ut("idle"):this.Ui?this.J.ut("jump"):this.J.ut("fall"),Math.sign(this.J.nt)!==this.ai&&(this.J.nt*=-1),this.Ui?(this.J.nt=M(this.J.nt,.8*this.ai,.9*n.H),this.J.rt=M(this.J.rt,1.16,.9*n.H)):(this.J.nt=M(this.J.nt,this.ai),this.J.rt=M(this.J.rt,1)),!this.Ht&&!this.Yt&&h&&0===this.Tt){let t=this.parent.O(j,{name:"bullet",tag:"flash"+(Math.random()<.4?"2":""),duration:.16});t.x=this.x+this.dx,t.y=this.y-8*Math.random(),t.J.nt=this.ai;let i=this.parent.O(C,{},this.x,t.y);i.dx=this.ai*p*2.5,i.J.nt=Math.sign(i.dx),i.bi=i.x,i.Qi=(0===this.dx?60:110)+30*Math.random(),this.Tt=.2}this.Tt=M(this.Tt,0),this.Mi=this.yi,this.Bi=this.y,this.J.x=-this.Tt*this.ai*12}}class C extends k{w=12;t=12;bi=0;Qi=120;oi=!1;get ki(){return Math.abs(this.x-this.bi)}get Kt(){return 0}get Pt(){return.1}Z(){this.J=this.O(a,{name:"bullet",duration:.1});let t=2*(.5-Math.random());this.dy=(1-x)*t*-60.8,w.play("bullet"+(Math.abs(t)>.5?"0":"1"))}$(){(this.ki>this.Qi||0!==this.St)&&(this.oi=!0),this.oi&&(this.parent.O(j,{name:"bullet",tag:"hit",duration:.4,scale:this.J.nt},this.x+this.J.x,this.y+this.J.y),this.remove())}}const V=[0,1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,18,19,20,21,22,24,25,26,27],D=t=>V.includes(t);!function(t){let i=function(t,i,s=!0){let h=document.createElement("canvas");s&&h.classList.add("pixelated");let n=h.getContext("2d");const r=()=>{h.width=t,h.height=i,n.imageSmoothingEnabled=!s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new e(h,n)}(320,180,!0);t.appendChild(i.canvas),v(i)}(document.getElementById("app"));
