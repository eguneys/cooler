const t=""+new URL("out_0--stZNr8g.png",import.meta.url).href,n=[{n:"Level_0",w:68,t:16,i:"AAAHAAAAAQACAAAEAAgAIAAoAQBOAB8AIAAhACIAIwAkAAEoAigDKAQoBSgGKAcoCCgJKAooCygMKA0oDigPKBAoESgSKBMoFCgVKBYoFygYKBkoGigbKBwoHSgeKB8oICghKCIoIygkKCUoJignKCgoKSgqKCsoLCgtKC4oLygwKDEoMigzKDQoNSg2KDcoOCg5KDooOyg8KD0oPig/KEAoQShCKCYsJywoLCksKiwrLAIAQwBAAEEAQgBDAEMEQwhDDEMcQygALAEsAiwDLAQsBSwGLAcsCCwJLAosCywMLA0sDiwPLBAsLCwtLC4sLywwLDEsMiwzLDQsNSw2LDcsOCw5LDosOyw8LD0sPiw/LEAsQSxCLEMsAzAEMAUwBjAHMAgwCTAKMAswDDANMC0wLjAvMDAwMTAyMA=="}];function e(t){function n(t){function n(t){return[8*(t%1024),8*Math.floor(t/1024)]}let e=[],i=function(t){const n=atob(t),e=n.length,i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=n.charCodeAt(s);return new Uint16Array(i.buffer)}(t);for(let s=0;s<i.length;){let t=i[s];s++;let r=i[s];s++;let o=[...i.slice(s,s+r)];s+=r,e.push(...o.map((e=>({src:n(t),px:n(e)}))))}return e}return t.map((t=>{let{n:e,w:i,t:s,i:r}=t;return{name:e,w:i,t:s,i:n(r)}}))}const i=new class{image;info;o;async load(){var i;this.image=await(i=t,new Promise((t=>{let n=new Image;n.onload=()=>t(n),n.src=i}))),this.info="loading\n\n0*1*audio\n2*4*input\n\n4*0*64\n4*0*94\n4*0*124\n4*0*154\n4*0*184\n\n\nnpc\n\n0*0*idle\n\n3*80*184\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n0*80*154\n0*96*154\n0*112*154\n0*80*124\n0*96*124\n\n\ntestldtk\n\n0*0*idle\n\n3*0*0".split("\n\n\n").map((t=>{let[n,e,i]=t.split("\n\n");return{name:n,tags:e.split("\n").map((t=>{let[n,e,i]=t.split("*");return{from:parseInt(n),to:parseInt(e),name:i}})),h:i.split("\n").map((t=>{let[n,e,i,s,r,o,h,a]=function(t){let[n,e,i]=t,s=0,r=0,[o,h]=0===n?[16,16]:1===n?[32,16]:2===n?[80,80]:4===n?[80,30]:[0,0],[a,u]=[o,h];return[s,r,o,h,e,i,a,u]}(t.split("*").map((t=>parseInt(t))));return{fx:n,fy:e,u:i,l:s,A:r,m:o,p:h,_:a}}))}})),this.o=e(n),console.log(this.o)}};class s{constructor(t,n){this.canvas=t,this.C=n}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{C:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,n,e,i,s){let{C:r}=this;r.fillStyle=s,r.fillRect(t,n,e,i)}M(t,n){let{C:e}=this;e.save(),e.translate(t,n)}pop(){let{C:t}=this;t.restore()}K(t,n,e,i=1,s=1){let{fx:r,fy:o,A:h,m:a,p:u,_:c}=t.L,{v:l,D:f}=t,g=n-r-l,A=e-o-f;this.I(g,A,h,a,u,c,i,s)}I(t,n,e,s,r,o,h=1,a=1){let{C:u}=this,{image:c}=i;u.save();let l=r,f=o,g=l*Math.abs(h),A=f*Math.abs(a);u.scale(Number(h.toFixed(2)),Number(a.toFixed(2))),h<0&&(t*=-1,t-=g),a<0&&(n*=-1,n-=A),u.drawImage(c,e,s,l,f,Math.round(t),Math.round(n),Math.round(g),Math.round(A)),u.restore()}}const r={B:16};class o{k;S(t){return this.k=t,this}P;N;O;U;j(t,n){this.U.push([t,n])}constructor(){this.O=[],this.N=[],this.U=[]}F(t,n){return(new t).S(n).init()}J(t,n={}){let e=this.F(t,n);return this.N.push(e),e}T(t,n={},e=7){let i=this.F(t,n);return this.N.push(i),this.O.push([i,e]),i}remove(t){let n=this.N.indexOf(t);if(-1===n)throw"noscene rm";this.N.splice(n,1),n=this.O.findIndex((([n])=>n===t)),-1!==n&&this.O.splice(n,1)}init(){return this.P=0,this.q(),this}update(){0===this.P&&this.G(),this.N.forEach((t=>t.update())),this.P+=r.B,this.U=this.U.map((([t,n])=>(t-r.B<0&&n(),[t-r.B,n]))).filter((t=>t[0]>0)),this.O.slice(0).forEach((([t,n])=>{let e=this.O.filter((n=>n[0].constructor.name===t.constructor.name));if(e.length>n){let t=e[0][0];this.remove(t)}})),this.H()}draw(t){this.Y(t),this.N.forEach((n=>n.draw(t))),this.$(t)}q(){}G(){}H(){}$(t){}Y(t){}}class h extends o{get data(){return this.k}get info(){let t=i.info.find((t=>t.name===this.R));if(!t)throw`nosprite ${this.R}`;return t}get duration(){return this.data.duration??400}get tag(){let t=this.info.tags.find((t=>t.name===this.V));if(!t)throw`notag ${this.R} ${this.V}`;return t}get R(){return this.data.name}get V(){return this.data.tag||"idle"}x=0;y=0;Z=1;W=1;X(t,n){this.x=t,this.y=n}_current_frame=0;get L(){let{from:t}=this.tag;return this.info.h[this._current_frame+t]}get tt(){return this.data.tt??"c"}get v(){if("tl"===this.tt)return 0;let{u:t}=this.L;return"c"===this.tt||"bc"===this.tt?t/2:0}get D(){if("tl"===this.tt)return 0;let{l:t}=this.L;return"c"===this.tt?t/2:"bc"===this.tt?t:0}nt(t){this.data.tag=t,this._current_frame=0,this.et=0}et=0;H(){let{from:t,to:n}=this.tag,{duration:e}=this,i=e/(n-t+1),s=n-t;this.et+=1e3*r.B,this.et>=i&&(this.et-=i,this._current_frame===s?this._current_frame=0:this._current_frame+=1)}$(t){let{x:n,y:e,Z:i,W:s}=this;t.K(this,n,e,i,s)}}const a=function(){let t=new Set;return document.addEventListener("keydown",(n=>{return e=n.key,void t.add(e);var e})),document.addEventListener("keyup",(n=>{return e=n.key,void t.delete(e);var e})),n=>[...t].includes(n)}();var u=function(){var t,n,e,i,s,r=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*2**((t-128)/12)},h=function(t,n,e){var i,s,r,h,u,c,l=a[t.it[0]],f=t.it[1],g=t.it[3]/32,A=a[t.it[4]],w=t.it[5],d=t.it[8]/32,m=t.it[9],p=t.it[10]*t.it[10]*4,_=t.it[11]*t.it[11]*4,y=t.it[12]*t.it[12]*4,C=1/y,M=-t.it[13]/16,x=t.it[14],K=e*2**(2-t.it[15]),L=new Int32Array(p+_+y),v=0,D=0;for(i=0,s=0;i<p+_+y;i++,s++)s>=0&&(s-=K,u=o(n+(15&(x=x>>8|(255&x)<<4))+t.it[2]-128),c=o(n+(15&x)+t.it[6]-128)*(1+8e-4*t.it[7])),r=1,i<p?r=i/p:i>=p+_&&(r=(1-(r=(i-p-_)*C))*3**(M*r)),h=l(v+=u*r**g)*f,h+=A(D+=c*r**d)*w,m&&(h+=(2*Math.random()-1)*m),L[i]=80*h*r|0;return L},a=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(r){t=r,n=r.st,e=0,i=r.rt*r.ot*(n+1)*2,s=new Int32Array(i)},this.ht=function(){var o,u,c,l,f,g,A,w,d,m,p,_,y,C,M=new Int32Array(i),x=t.ut[e],K=t.rt,L=t.ot,v=0,D=0,E=!1,I=[];for(c=0;c<=n;++c)for(A=x.ct[c],l=0;l<L;++l){var B=A?x.c[A-1].f[l]:0;B&&(x.it[B-1]=x.c[A-1].f[l+L]||0,B<17&&(I=[]));var k=a[x.it[16]],Q=x.it[17]/512,S=2**(x.it[18]-9)/K,b=x.it[19],P=x.it[20],N=43.23529*x.it[21]*3.141592/44100,O=1-x.it[22]/255,U=1e-5*x.it[23],j=x.it[24]/32,z=x.it[25]/512,F=6.283184*2**(x.it[26]-9)/K,J=x.it[27]/255,T=x.it[28]*K&-2;for(p=(c*L+l)*K,f=0;f<4;++f)if(g=A?x.c[A-1].n[l+f*L]:0){I[g]||(I[g]=h(x,g,K));var q=I[g];for(u=0,o=2*p;u<q.length;u++,o+=2)M[o]+=q[u]}for(u=0;u<K;u++)(m=M[w=2*(p+u)])||E?(_=N,b&&(_*=k(S*w)*Q+.5),D+=(_=1.5*Math.sin(_))*(y=O*(m-D)-(v+=_*D)),m=3==P?D:1==P?y:v,U&&(m=(m*=U)<1?m>-1?r(.25*m):-1:1,m/=U),E=(m*=j)*m>1e-5,C=m*(1-(d=Math.sin(F*w)*z+.5)),m*=d):C=0,w>=T&&(C+=M[w-T+1]*J,m+=M[w-T]*J),M[w]=0|C,M[w+1]=0|m,s[w]+=0|C,s[w+1]+=0|m}return++e/t.lt},this.ft=function(t){for(var n=t.createBuffer(2,i/2,44100),e=0;e<2;e++)for(var r=n.getChannelData(e),o=e;o<i;o+=2)r[o>>1]=s[o]/65536;return n}};const c={ut:[{it:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],ct:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{it:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],ct:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{it:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],ct:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],rt:7350,ot:32,st:22,lt:3},l=function(){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const e={},i=[{name:"song",data:c}];return{ht:()=>(i.forEach((n=>{let i=new u;i.init(n.data),function s(){if(1===i.ht()){let s=i.ft(t);((t,n)=>{e[t]=n})(n.name,s)}else setTimeout(s,0)}()})),new Promise((t=>{!function n(){Object.keys(e).length!==i.length?setTimeout(n,100):t()}()}))),play:(i,s=!1)=>{const r=e[i];if(!r)return;let o=t.createBufferSource(),h=t.createGain();return o.buffer=r,o.connect(h),h.connect(n),o.loop=s,h.gain.value=.8,o.start(),()=>{o.stop()}}}}();function f(t){let n;const e=i=>{n=new i,n.S({g:t,go:e}),n.init()};e(A),function(t){let n;const e=i=>{r.B=Math.max(16,n?i-n:16)/1e3,n=i,t(),requestAnimationFrame(e)};requestAnimationFrame(e)}((()=>{n.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),n.draw(t)}))}class g extends o{gt=!1;At;get data(){return this.k}get g(){return this.data.g}go(t){this.data.go(t)}update(){a("m")?this.gt||(this.gt=!0,this.At?(this.At(),this.At=void 0):this.At=l.play("song",!0)):this.gt=!1,super.update()}}class A extends g{q(){i.load().then((()=>{let t=this.J(h,{name:"loading",tag:"audio",duration:1e3});t.x=160,t.y=90,l.ht().then((()=>{this.go(w)}))}))}}class w extends g{q(){const t=()=>{document.removeEventListener("keydown",t),this.go(d)};document.addEventListener("keydown",t);let n=this.J(h,{name:"loading",tag:"input",duration:1e3});n.x=260,n.y=160}}class d extends g{q(){this.At=l.play("song",!0)}}!function(t){let n=function(t,n,e=!0){let i=document.createElement("canvas");e&&i.classList.add("pixelated");let r=i.getContext("2d");const o=()=>{i.width=t,i.height=n,r.imageSmoothingEnabled=e};return document.addEventListener("scroll",o,{capture:!0,passive:!0}),window.addEventListener("resize",o,{passive:!0}),o(),new s(i,r)}(320,180,!0);t.appendChild(n.canvas),f(n)}(document.getElementById("app"));
