var t=Object.defineProperty,n=(n,e,i)=>((n,e,i)=>e in n?t(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i)(n,"symbol"!=typeof e?e+"":e,i);const e=new class{constructor(){n(this,"image"),n(this,"info")}async load(){var t;this.image=await(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAACmCAYAAAAChwt5AAAC30lEQVR42u3bXW6jMBQG0G6jTyPNBvrAEqb731JGfagURYCv/4Kxz5GiyVAI1B82huZ+fAAAAAAArWzb9mixfe3n3GW/wwf48/+9RtlbL3d5qrGff556f3SMywVa0mjP/0aXpXp8ZJvafSwZYO6y6PqpY2ixXwEmzvqannPU+wTYIMTIde13vWhDpiYdkX2c7Xfv2M+OjYtmvVwU2pIzRAAAAAAAAAAAALgX1UmTBag66cYBqk6aMEDVSZMEqDrpRiHOVp3EQLNeLgpNdRIAAAAAAACs5ev7n78P5jbY7+u1EfeWvzbw0fZ760aCOlu+d4zLhx4J7my9kh4U2T4VlgALgznqgall0Z5zdvLogYmhKRVg7pCYOhFyemDOSbVkD4yc0a/XttrrXyr0yOem9mXW5/g1QO+hHwDgNpMiN/IdZ4aRm/Cjn589l43cE6buJc1iC3tG5ElN6rls5Pno2VMlz1EvCjD62bnLhHfjAIWXEWKLa+BZ4JGwc57Z6qEAAAAAAFTxgLmgwVQvTXLGq16aKMBoo6teGmQIjQSoemngHqh6yazP8WuAsqEfAODSiY6b846zPRVJk/RAFUkCVJEkQBVJ1SGqSAIAAAAAYHkeOhc0mCqlSc54VUoTBRhtdFVKgwyhkQBVKQ3cA1UpmfVNf/zbtj0E2GHof3d4P+9fX+5nBiawiYLUCsAAkxo34h1ndiqSJumBKpIEqCJJgCqSqkNUkQQAAACwktqvMrTc3l/mCxpv733v7fe+ByPEisYvabjS7Z+DSr2Ga7TPP38fOa+Rwytp7Gh4LYZmQ2cwuOjQF+lxvl7YcfJx1EMin5MbnCA7hl3SW3LDu8UQesW1L3UtLBk6a7Zvef17W9jvDqnVL90rxJpJ0fKTndJ7v9KGTvXGkpPK9a1wItJrItNySB7i3vCdAR794rXDX6/hM/ckXHpIjQbVa/vWI8LSN/41M8RWD789BJhgQhXxH6B+OZD042IaAAAAAElFTkSuQmCC",new Promise((n=>{let e=new Image;e.onload=()=>n(e),e.src=t}))),this.info="loading\n\n0*1*audio\n2*4*input\n\n4*0*0\n4*0*30\n4*0*60\n4*0*90\n4*0*120\n\n\nnpc\n\n0*0*idle\n\n3*0*150\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n0*48*150\n0*64*150\n0*80*150\n0*96*150\n0*80*120".split("\n\n\n").map((t=>{let[n,e,i]=t.split("\n\n");return{name:n,tags:e.split("\n").map((t=>{let[n,e,i]=t.split("*");return{from:parseInt(n),to:parseInt(e),name:i}})),t:i.split("\n").map((t=>{let[n,e,i,s,r,h,a,o]=function(t){let[n,e,i]=t,s=0,r=0,[h,a]=0===n?[16,16]:1===n?[32,16]:2===n?[80,80]:4===n?[80,30]:[0,0],[o,u]=[h,a];return[s,r,h,a,e,i,o,u]}(t.split("*").map((t=>parseInt(t))));return{fx:n,fy:e,i:i,h:s,o:r,u:h,l:a,A:o}}))}}))}},i=class{constructor(t,n){this.canvas=t,this.m=n}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{m:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,n,e,i,s){let{m:r}=this;r.fillStyle=s,r.fillRect(t,n,e,i)}p(t,n){let{m:e}=this;e.save(),e.translate(t,n)}pop(){let{m:t}=this;t.restore()}v(t,n,e,i=1,s=1){let{fx:r,fy:h,o:a,u:o,l:u,A:c}=t._,{k:l,M:f}=t,A=n-r-l,d=e-h-f;this.C(A,d,a,o,u,c,i,s)}C(t,n,i,s,r,h,a=1,o=1){let{m:u}=this,{image:c}=e;u.save();let l=r,f=h,A=l*Math.abs(a),d=f*Math.abs(o);u.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=A),o<0&&(n*=-1,n-=d),u.drawImage(c,i,s,l,f,Math.round(t),Math.round(n),Math.round(A),Math.round(d)),u.restore()}};n(i,"make",((t,n,e=!0)=>{let s=document.createElement("canvas");e&&s.classList.add("pixelated");let r=s.getContext("2d");const h=()=>{s.width=t,s.height=n,r.imageSmoothingEnabled=e};return document.addEventListener("scroll",h,{capture:!0,passive:!0}),window.addEventListener("resize",h,{passive:!0}),h(),new i(s,r)}));let s=i;const r={I:16};class h{constructor(){n(this,"_data"),n(this,"life"),n(this,"objects"),n(this,"pools"),n(this,"_scheds"),this.q=[],this.V=[],this.L=[]}S(t){return this.B=t,this}X(t,n){this.L.push([t,n])}j(t,n){return(new t).S(n).init()}G(t,n={}){let e=this.j(t,n);return this.V.push(e),e}J(t,n={},e=7){let i=this.j(t,n);return this.V.push(i),this.q.push([i,e]),i}remove(t){let n=this.V.indexOf(t);if(-1===n)throw"noscene rm";this.V.splice(n,1),n=this.q.findIndex((([n])=>n===t)),-1!==n&&this.q.splice(n,1)}init(){return this.Y=0,this.O(),this}update(){0===this.Y&&this.P(),this.V.forEach((t=>t.update())),this.Y+=r.I,this.L=this.L.map((([t,n])=>(t-r.I<0&&n(),[t-r.I,n]))).filter((t=>t[0]>0)),this.q.slice(0).forEach((([t,n])=>{let e=this.q.filter((n=>n[0].constructor.name===t.constructor.name));if(e.length>n){let t=e[0][0];this.remove(t)}})),this.D()}draw(t){this.R(t),this.V.forEach((n=>n.draw(t))),this.T(t)}O(){}P(){}D(){}T(t){}R(t){}}class a extends h{constructor(){super(...arguments),n(this,"x",0),n(this,"y",0),n(this,"scale_x",1),n(this,"scale_y",1),n(this,"_current_frame",0),n(this,"__elapsed",0)}get data(){return this.B}get info(){let t=e.info.find((t=>t.name===this.U));if(!t)throw`nosprite ${this.U}`;return t}get duration(){return this.data.duration??400}get tag(){let t=this.info.tags.find((t=>t.name===this.W));if(!t)throw`notag ${this.U} ${this.W}`;return t}get U(){return this.data.name}get W(){return this.data.tag||"idle"}N(t,n){this.x=t,this.y=n}get _(){let{from:t}=this.tag;return this.info.t[this.Z+t]}get K(){return this.data.K??"c"}get k(){if("tl"===this.K)return 0;let{i:t}=this._;return"c"===this.K||"bc"===this.K?t/2:0}get M(){if("tl"===this.K)return 0;let{h:t}=this._;return"c"===this.K?t/2:"bc"===this.K?t:0}H(t){this.data.tag=t,this.Z=0,this.F=0}D(){let{from:t,to:n}=this.tag,{duration:e}=this,i=e/(n-t+1),s=n-t;this.F+=1e3*r.I,this.F>=i&&(this.F-=i,this.Z===s?this.Z=0:this.Z+=1)}T(t){let{x:n,y:e,$:i,tt:s}=this;t.v(this,n,e,i,s)}}const o=function(){let t=new Set;return document.addEventListener("keydown",(n=>{return e=n.key,void t.add(e);var e})),document.addEventListener("keyup",(n=>{return e=n.key,void t.delete(e);var e})),n=>[...t].includes(n)}();var u=function(){var t,n,e,i,s,r=function(t){return Math.sin(6.283184*t)},h=function(t){return.003959503758*2**((t-128)/12)},a=function(t,n,e){var i,s,r,a,u,c,l=o[t.nt[0]],f=t.nt[1],A=t.nt[3]/32,d=o[t.nt[4]],g=t.nt[5],m=t.nt[8]/32,p=t.nt[9],w=t.nt[10]*t.nt[10]*4,v=t.nt[11]*t.nt[11]*4,y=t.nt[12]*t.nt[12]*4,_=1/y,x=-t.nt[13]/16,b=t.nt[14],k=e*2**(2-t.nt[15]),M=new Int32Array(w+v+y),C=0,I=0;for(i=0,s=0;i<w+v+y;i++,s++)s>=0&&(s-=k,u=h(n+(15&(b=b>>8|(255&b)<<4))+t.nt[2]-128),c=h(n+(15&b)+t.nt[6]-128)*(1+8e-4*t.nt[7])),r=1,i<w?r=i/w:i>=w+v&&(r=(1-(r=(i-w-v)*_))*3**(x*r)),a=l(C+=u*r**A)*f,a+=d(I+=c*r**m)*g,p&&(a+=(2*Math.random()-1)*p),M[i]=80*a*r|0;return M},o=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(r){t=r,n=r.et,e=0,i=r.it*r.st*(n+1)*2,s=new Int32Array(i)},this.rt=function(){var h,u,c,l,f,A,d,g,m,p,w,v,y,_,x=new Int32Array(i),b=t.ht[e],k=t.it,M=t.st,C=0,I=0,q=!1,V=[];for(c=0;c<=n;++c)for(d=b.ot[c],l=0;l<M;++l){var E=d?b.c[d-1].f[l]:0;E&&(b.nt[E-1]=b.c[d-1].f[l+M]||0,E<17&&(V=[]));var L=o[b.nt[16]],S=b.nt[17]/512,B=2**(b.nt[18]-9)/k,Q=b.nt[19],X=b.nt[20],j=43.23529*b.nt[21]*3.141592/44100,G=1-b.nt[22]/255,J=1e-5*b.nt[23],Y=b.nt[24]/32,O=b.nt[25]/512,P=6.283184*2**(b.nt[26]-9)/k,D=b.nt[27]/255,R=b.nt[28]*k&-2;for(w=(c*M+l)*k,f=0;f<4;++f)if(A=d?b.c[d-1].n[l+f*M]:0){V[A]||(V[A]=a(b,A,k));var T=V[A];for(u=0,h=2*w;u<T.length;u++,h+=2)x[h]+=T[u]}for(u=0;u<k;u++)(p=x[g=2*(w+u)])||q?(v=j,Q&&(v*=L(B*g)*S+.5),I+=(v=1.5*Math.sin(v))*(y=G*(p-I)-(C+=v*I)),p=3==X?I:1==X?y:C,J&&(p=(p*=J)<1?p>-1?r(.25*p):-1:1,p/=J),q=(p*=Y)*p>1e-5,_=p*(1-(m=Math.sin(P*g)*O+.5)),p*=m):_=0,g>=R&&(_+=x[g-R+1]*D,p+=x[g-R]*D),x[g]=0|_,x[g+1]=0|p,s[g]+=0|_,s[g+1]+=0|p}return++e/t.ut},this.ct=function(t){for(var n=t.createBuffer(2,i/2,44100),e=0;e<2;e++)for(var r=n.getChannelData(e),h=e;h<i;h+=2)r[h>>1]=s[h]/65536;return n}};const c={ht:[{nt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],ot:[1,2,1,2,,,,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{nt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],ot:[1,2,1,2,1,2,1,2,1,1,2,2,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]}]},{nt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],ot:[,,1,2,1,1,2,2,,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]}]}],it:7350,st:32,et:12,ut:3},l=function(){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const e={},i=[{name:"song",data:c}];return{rt:()=>(i.forEach((n=>{let i=new u;i.init(n.data),function s(){if(1===i.rt()){let s=i.ct(t);((t,n)=>{e[t]=n})(n.name,s)}else setTimeout(s,0)}()})),new Promise((t=>{!function n(){Object.keys(e).length!==i.length?setTimeout(n,100):t()}()}))),play:(i,s=!1)=>{const r=e[i];if(!r)return;let h=t.createBufferSource(),a=t.createGain();return h.buffer=r,h.connect(a),a.connect(n),h.loop=s,a.gain.value=.8,h.start(),()=>{h.stop()}}}}();function f(t){let n;const e=i=>{n=new i,n.S({g:t,go:e}),n.init()};e(d),function(t){let n;const e=i=>{r.I=Math.max(16,n?i-n:16)/1e3,n=i,t(),requestAnimationFrame(e)};requestAnimationFrame(e)}((()=>{n.update(),t.clear(),t.fr(0,0,320,180,"#0a0a0a"),n.draw(t)}))}class A extends h{constructor(){super(...arguments),n(this,"up_p",!1),n(this,"song")}get data(){return this.B}get g(){return this.data.g}go(t){this.data.go(t)}update(){o("m")?this.lt||(this.lt=!0,this.ft?(this.ft(),this.ft=void 0):this.ft=l.play("song")):this.lt=!1,super.update()}}class d extends A{O(){e.load().then((()=>{let t=this.G(a,{name:"loading",tag:"audio",duration:1e3});t.x=160,t.y=90,l.rt().then((()=>{this.go(g)}))}))}}class g extends A{O(){const t=()=>{document.removeEventListener("keydown",t),this.go(m)};document.addEventListener("keydown",t);let n=this.G(a,{name:"loading",tag:"input",duration:1e3});n.x=260,n.y=160}}class m extends A{O(){this.ft=l.play("song")}}!function(t){let n=s.G(320,180,!0);t.appendChild(n.canvas),f(n)}(document.getElementById("app"));
