const t=new class{image;info;async load(){var t;this.image=await(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAACmCAYAAAAChwt5AAAC30lEQVR42u3bXW6jMBQG0G6jTyPNBvrAEqb731JGfagURYCv/4Kxz5GiyVAI1B82huZ+fAAAAAAArWzb9mixfe3n3GW/wwf48/+9RtlbL3d5qrGff556f3SMywVa0mjP/0aXpXp8ZJvafSwZYO6y6PqpY2ixXwEmzvqannPU+wTYIMTIde13vWhDpiYdkX2c7Xfv2M+OjYtmvVwU2pIzRAAAAAAAAAAAALgX1UmTBag66cYBqk6aMEDVSZMEqDrpRiHOVp3EQLNeLgpNdRIAAAAAAACs5ev7n78P5jbY7+u1EfeWvzbw0fZ760aCOlu+d4zLhx4J7my9kh4U2T4VlgALgznqgall0Z5zdvLogYmhKRVg7pCYOhFyemDOSbVkD4yc0a/XttrrXyr0yOem9mXW5/g1QO+hHwDgNpMiN/IdZ4aRm/Cjn589l43cE6buJc1iC3tG5ElN6rls5Pno2VMlz1EvCjD62bnLhHfjAIWXEWKLa+BZ4JGwc57Z6qEAAAAAAFTxgLmgwVQvTXLGq16aKMBoo6teGmQIjQSoemngHqh6yazP8WuAsqEfAODSiY6b846zPRVJk/RAFUkCVJEkQBVJ1SGqSAIAAAAAYHkeOhc0mCqlSc54VUoTBRhtdFVKgwyhkQBVKQ3cA1UpmfVNf/zbtj0E2GHof3d4P+9fX+5nBiawiYLUCsAAkxo34h1ndiqSJumBKpIEqCJJgCqSqkNUkQQAAACwktqvMrTc3l/mCxpv733v7fe+ByPEisYvabjS7Z+DSr2Ga7TPP38fOa+Rwytp7Gh4LYZmQ2cwuOjQF+lxvl7YcfJx1EMin5MbnCA7hl3SW3LDu8UQesW1L3UtLBk6a7Zvef17W9jvDqnVL90rxJpJ0fKTndJ7v9KGTvXGkpPK9a1wItJrItNySB7i3vCdAR794rXDX6/hM/ckXHpIjQbVa/vWI8LSN/41M8RWD789BJhgQhXxH6B+OZD042IaAAAAAElFTkSuQmCC",new Promise((n=>{let e=new Image;e.onload=()=>n(e),e.src=t}))),this.info="loading\n\n0*1*audio\n2*4*input\n\n4*0*0\n4*0*30\n4*0*60\n4*0*90\n4*0*120\n\n\nnpc\n\n0*0*idle\n\n3*0*150\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n0*48*150\n0*64*150\n0*80*150\n0*96*150\n0*80*120".split("\n\n\n").map((t=>{let[n,e,i]=t.split("\n\n");return{name:n,tags:e.split("\n").map((t=>{let[n,e,i]=t.split("*");return{from:parseInt(n),to:parseInt(e),name:i}})),t:i.split("\n").map((t=>{let[n,e,i,s,r,a,h,o]=function(t){let[n,e,i]=t,s=0,r=0,[a,h]=0===n?[16,16]:1===n?[32,16]:2===n?[80,80]:4===n?[80,30]:[0,0],[o,u]=[a,h];return[s,r,a,h,e,i,o,u]}(t.split("*").map((t=>parseInt(t))));return{fx:n,fy:e,i:i,h:s,o:r,u:a,l:h,A:o}}))}}))}};class n{constructor(t,n){this.canvas=t,this.m=n}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{m:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,n,e,i,s){let{m:r}=this;r.fillStyle=s,r.fillRect(t,n,e,i)}p(t,n){let{m:e}=this;e.save(),e.translate(t,n)}pop(){let{m:t}=this;t.restore()}v(t,n,e,i=1,s=1){let{fx:r,fy:a,o:h,u:o,l:u,A:c}=t._,{k:l,M:A}=t,f=n-r-l,d=e-a-A;this.C(f,d,h,o,u,c,i,s)}C(n,e,i,s,r,a,h=1,o=1){let{m:u}=this,{image:c}=t;u.save();let l=r,A=a,f=l*Math.abs(h),d=A*Math.abs(o);u.scale(Number(h.toFixed(2)),Number(o.toFixed(2))),h<0&&(n*=-1,n-=f),o<0&&(e*=-1,e-=d),u.drawImage(c,i,s,l,A,Math.round(n),Math.round(e),Math.round(f),Math.round(d)),u.restore()}}const e={I:16};class i{q;V(t){return this.q=t,this}L;S;B;X;G(t,n){this.X.push([t,n])}constructor(){this.B=[],this.S=[],this.X=[]}J(t,n){return(new t).V(n).init()}Y(t,n={}){let e=this.J(t,n);return this.S.push(e),e}j(t,n={},e=7){let i=this.J(t,n);return this.S.push(i),this.B.push([i,e]),i}remove(t){let n=this.S.indexOf(t);if(-1===n)throw"noscene rm";this.S.splice(n,1),n=this.B.findIndex((([n])=>n===t)),-1!==n&&this.B.splice(n,1)}init(){return this.L=0,this.P(),this}update(){0===this.L&&this.D(),this.S.forEach((t=>t.update())),this.L+=e.I,this.X=this.X.map((([t,n])=>(t-e.I<0&&n(),[t-e.I,n]))).filter((t=>t[0]>0)),this.B.slice(0).forEach((([t,n])=>{let e=this.B.filter((n=>n[0].constructor.name===t.constructor.name));if(e.length>n){let t=e[0][0];this.remove(t)}})),this.O()}draw(t){this.R(t),this.S.forEach((n=>n.draw(t))),this.T(t)}P(){}D(){}O(){}T(t){}R(t){}}class s extends i{get data(){return this.q}get info(){let n=t.info.find((t=>t.name===this.U));if(!n)throw`nosprite ${this.U}`;return n}get duration(){return this.data.duration??400}get tag(){let t=this.info.tags.find((t=>t.name===this.W));if(!t)throw`notag ${this.U} ${this.W}`;return t}get U(){return this.data.name}get W(){return this.data.tag||"idle"}x=0;y=0;N=1;Z=1;K(t,n){this.x=t,this.y=n}_current_frame=0;get _(){let{from:t}=this.tag;return this.info.t[this._current_frame+t]}get H(){return this.data.H??"c"}get k(){if("tl"===this.H)return 0;let{i:t}=this._;return"c"===this.H||"bc"===this.H?t/2:0}get M(){if("tl"===this.H)return 0;let{h:t}=this._;return"c"===this.H?t/2:"bc"===this.H?t:0}F(t){this.data.tag=t,this._current_frame=0,this.$=0}$=0;O(){let{from:t,to:n}=this.tag,{duration:i}=this,s=i/(n-t+1),r=n-t;this.$+=1e3*e.I,this.$>=s&&(this.$-=s,this._current_frame===r?this._current_frame=0:this._current_frame+=1)}T(t){let{x:n,y:e,N:i,Z:s}=this;t.v(this,n,e,i,s)}}const r=function(){let t=new Set;return document.addEventListener("keydown",(n=>{return e=n.key,void t.add(e);var e})),document.addEventListener("keyup",(n=>{return e=n.key,void t.delete(e);var e})),n=>[...t].includes(n)}();var a=function(){var t,n,e,i,s,r=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},h=function(t,n,e){var i,s,r,h,u,c,l=o[t.tt[0]],A=t.tt[1],f=t.tt[3]/32,d=o[t.tt[4]],g=t.tt[5],m=t.tt[8]/32,p=t.tt[9],w=t.tt[10]*t.tt[10]*4,v=t.tt[11]*t.tt[11]*4,y=t.tt[12]*t.tt[12]*4,_=1/y,x=-t.tt[13]/16,k=t.tt[14],M=e*2**(2-t.tt[15]),C=new Int32Array(w+v+y),I=0,b=0;for(i=0,s=0;i<w+v+y;i++,s++)s>=0&&(s-=M,u=a(n+(15&(k=k>>8|(255&k)<<4))+t.tt[2]-128),c=a(n+(15&k)+t.tt[6]-128)*(1+8e-4*t.tt[7])),r=1,i<w?r=i/w:i>=w+v&&(r=(1-(r=(i-w-v)*_))*3**(x*r)),h=l(I+=u*r**f)*A,h+=d(b+=c*r**m)*g,p&&(h+=(2*Math.random()-1)*p),C[i]=80*h*r|0;return C},o=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(r){t=r,n=r.nt,e=0,i=r.et*r.it*(n+1)*2,s=new Int32Array(i)},this.st=function(){var a,u,c,l,A,f,d,g,m,p,w,v,y,_,x=new Int32Array(i),k=t.rt[e],M=t.et,C=t.it,I=0,b=0,q=!1,V=[];for(c=0;c<=n;++c)for(d=k.ht[c],l=0;l<C;++l){var E=d?k.c[d-1].f[l]:0;E&&(k.tt[E-1]=k.c[d-1].f[l+C]||0,E<17&&(V=[]));var L=o[k.tt[16]],S=k.tt[17]/512,B=2**(k.tt[18]-9)/M,Q=k.tt[19],X=k.tt[20],G=43.23529*k.tt[21]*3.141592/44100,J=1-k.tt[22]/255,Y=1e-5*k.tt[23],j=k.tt[24]/32,P=k.tt[25]/512,D=6.283184*2**(k.tt[26]-9)/M,O=k.tt[27]/255,R=k.tt[28]*M&-2;for(w=(c*C+l)*M,A=0;A<4;++A)if(f=d?k.c[d-1].n[l+A*C]:0){V[f]||(V[f]=h(k,f,M));var T=V[f];for(u=0,a=2*w;u<T.length;u++,a+=2)x[a]+=T[u]}for(u=0;u<M;u++)(p=x[g=2*(w+u)])||q?(v=G,Q&&(v*=L(B*g)*S+.5),b+=(v=1.5*Math.sin(v))*(y=J*(p-b)-(I+=v*b)),p=3==X?b:1==X?y:I,Y&&(p=(p*=Y)<1?p>-1?r(.25*p):-1:1,p/=Y),q=(p*=j)*p>1e-5,_=p*(1-(m=Math.sin(D*g)*P+.5)),p*=m):_=0,g>=R&&(_+=x[g-R+1]*O,p+=x[g-R]*O),x[g]=0|_,x[g+1]=0|p,s[g]+=0|_,s[g+1]+=0|p}return++e/t.ot},this.ut=function(t){for(var n=t.createBuffer(2,i/2,44100),e=0;e<2;e++)for(var r=n.getChannelData(e),a=e;a<i;a+=2)r[a>>1]=s[a]/65536;return n}};const h={rt:[{tt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],ht:[1,2,1,2,,,,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{tt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],ht:[1,2,1,2,1,2,1,2,1,1,2,2,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]}]},{tt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],ht:[,,1,2,1,1,2,2,,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]}]}],et:7350,it:32,nt:12,ot:3},o=function(){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const e={},i=[{name:"song",data:h}];return{st:()=>(i.forEach((n=>{let i=new a;i.init(n.data),function s(){if(1===i.st()){let s=i.ut(t);((t,n)=>{e[t]=n})(n.name,s)}else setTimeout(s,0)}()})),new Promise((t=>{!function n(){Object.keys(e).length!==i.length?setTimeout(n,100):t()}()}))),play:(i,s=!1)=>{const r=e[i];if(!r)return;let a=t.createBufferSource(),h=t.createGain();return a.buffer=r,a.connect(h),h.connect(n),a.loop=s,h.gain.value=.8,a.start(),()=>{a.stop()}}}}();function u(t){let n;const i=e=>{n=new e,n.V({g:t,go:i}),n.init()};i(l),function(t){let n;const i=s=>{e.I=Math.max(16,n?s-n:16)/1e3,n=s,t(),requestAnimationFrame(i)};requestAnimationFrame(i)}((()=>{n.update(),t.clear(),t.fr(0,0,320,180,"#0a0a0a"),n.draw(t)}))}class c extends i{ct=!1;lt;get data(){return this.q}get g(){return this.data.g}go(t){this.data.go(t)}update(){r("m")?this.ct||(this.ct=!0,this.lt?(this.lt(),this.lt=void 0):this.lt=o.play("song")):this.ct=!1,super.update()}}class l extends c{P(){t.load().then((()=>{let t=this.Y(s,{name:"loading",tag:"audio",duration:1e3});t.x=160,t.y=90,o.st().then((()=>{this.go(A)}))}))}}class A extends c{P(){const t=()=>{document.removeEventListener("keydown",t),this.go(f)};document.addEventListener("keydown",t);let n=this.Y(s,{name:"loading",tag:"input",duration:1e3});n.x=260,n.y=160}}class f extends c{P(){this.lt=o.play("song")}}!function(t){let e=function(t,e,i=!0){let s=document.createElement("canvas");i&&s.classList.add("pixelated");let r=s.getContext("2d");const a=()=>{s.width=t,s.height=e,r.imageSmoothingEnabled=i};return document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),a(),new n(s,r)}(320,180,!0);t.appendChild(e.canvas),u(e)}(document.getElementById("app"));
