const t=""+new URL("out_0--cE3OQbq.png",import.meta.url).href,i=[{n:"Level_0",w:68,t:22,i:"AQQcAD04E0wUTBVMFkwXTBFQElATUBRQFVAWUBdQGFAAVA9UEFQRVBJUE1QUVBVUFlQXVBhUGVQaVENUAAQJAEM0PDhDOEM8Q0BDRENIQ0xDUAEIAwAxPD08JUQCBAoAADAANAA4PjgAPABAAEQASABMAFABAD8APTQxOCVAFEgVSBZIEkwQUBlQAVQCVANUBFQFVAZUB1QIVAlUClQLVAxUDVQOVBtUHFQdVB5UH1QgVCFUIlQjVCRUJVQmVCdUKFQpVCpUK1QsVC1ULlQvVDBUMVQyVDNUNFQ1VDZUN1Q4VDlUOlQ7VDxUPVQ+VD9UQFRBVEJUAAgEABw8MDw8PCREAggEAB08Mjw+PCZEAgAIAAAsPjQdODI4JkAXSBhMGlAAAAgAQzA8NBw4MDgkQBNIEUwPUBNMAQAFRBJMAQArJA=="}];function s(t){function i(t){function i(t){return[8*(t%1024),8*Math.floor(t/1024)]}let s=[],e=function(t){const i=atob(t),s=i.length,e=new Uint8Array(s);for(let h=0;h<s;h++)e[h]=i.charCodeAt(h);return new Uint16Array(e.buffer)}(t);for(let h=0;h<e.length;){let t=e[h];h++;let n=e[h];h++;let r=[...e.slice(h,h+n)];h+=n,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:e,t:h,i:n}=t;return{name:s,w:e,t:h,i:i(n)}}))}const e=new class{image;info;h;o;async load(){var e;this.image=await(e=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=e}))),this.info="bar\n\n0*0*idle\n1*1*end\n2*2*middle\n3*3*thumb\n\n4*160*96\n4*160*126\n4*0*160\n4*80*160\n\n\nbullet\n\n0*3*idle\n4*6*hit\n7*8*flash\n9*10*flash2\n\n0*80*220\n0*96*220\n0*112*220\n0*128*220\n0*144*220\n0*160*220\n0*176*220\n0*192*220\n0*208*220\n0*224*220\n0*240*220\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*160*160\n4*0*190\n4*80*190\n4*160*190\n4*0*220\n\n\nmain_char\n\n0*1*idle\n2*6*run\n7*10*jump\n11*14*fall\n15*17*ledge\n\n0*240*190\n0*240*160\n0*240*126\n0*240*96\n0*0*250\n0*16*250\n0*32*250\n0*48*250\n0*64*250\n0*80*250\n0*96*250\n0*112*250\n0*128*250\n0*144*250\n0*160*250\n0*176*250\n0*192*250\n0*208*250\n0*224*250\n0*240*250\n0*0*266\n\n\none_char\n\n0*1*idle\n2*4*hit\n\n0*16*266\n0*32*266\n0*48*266\n0*64*266\n0*80*266\n\n\ntiles\n\n0*0*idle\n\n3*0*0\n\n\ntwo_char\n\n0*3*idle\n4*5*damage\n6*8*split\n\n5*160*0\n5*192*0\n5*224*0\n5*160*32\n5*192*32\n5*224*32\n5*160*64\n5*192*64\n5*224*64".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,e]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,e]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:e}})),l:e.split(/\r?\n/).map((t=>{let[i,s,e,h,n,r,a,o]=function(t){let[i,s,e]=t,h=0,n=0,[r,a]=0===i?[16,16]:1===i?[32,16]:2===i?[80,80]:3===i?[160,160]:4===i?[80,30]:5===i?[32,32]:[0,0],[o,l]=[r,a];return[h,n,r,a,s,e,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:e,_:h,m:n,p:r,A:a,M:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],this.h=s(i),console.log(this.h)}};class h{constructor(t,i){this.canvas=t,this.v=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{v:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,e,h){let{v:n}=this;n.fillStyle=h,n.fillRect(t,i,s,e)}U(t,i){let{v:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{v:t}=this;t.restore()}V(t,i,s){let{fx:h,fy:n,m:r,p:a}=e.o,o=i-h,l=s-n,u=t%20*8,c=8*Math.floor(t/20);this.B(o,l,r+u,a+c,8,8)}k(t,i,s,e=1,h=1){let{fx:n,fy:r,m:a,p:o,A:l,M:u}=t.D,{F:c,I:d}=t,f=i-n-c,_=s-r-d;this.B(f,_,a,o,l,u,e,h)}B(t,i,s,h,n,r,a=1,o=1){let{v:l}=this,{image:u}=e;l.save();let c=n,d=r,f=c*Math.abs(a),_=d*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=f),o<0&&(i*=-1,i-=_),l.drawImage(u,s,h,c,d,Math.round(t),Math.round(i),Math.round(f),Math.round(_)),l.restore()}}const n={C:16,N:16,time:0,P(t,i=0){let{N:s,time:e}=this;return Math.floor((e-i-s)/t)<Math.floor((e-i)/t)}};class r{constructor(t,i){this.x=t,this.y=i}static j=t=>new r(Math.cos(t),Math.sin(t));static S=(t,i)=>new r(t,i);static get R(){return new r(0,0)}static get unit(){return new r(1,1)}get J(){return[this.x,this.y]}get O(){return new r(this.x/2,this.y/2)}get L(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.L)}get normalize(){return 0===this.length?r.R:this.scale(1/this.length)}get T(){return new r(-this.y,this.x)}get clone(){return new r(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}q(t){return this.x*t.x+this.y*t.y}Z(t){return this.x*t.y-this.y*t.x}G(t){return this.sub(t).length}scale(t){return new r(this.x*t,this.y*t)}add(t){return new r(this.x+t.x,this.y+t.y)}sub(t){return new r(this.x-t.x,this.y-t.y)}mul(t){return new r(this.x*t.x,this.y*t.y)}X(t){return r.j(this.angle+t)}}class a{constructor(t,i){this.$=t,this.r=i}static S=(t,i,s)=>new a(r.S(t,i),s);static get unit(){return a.S(0,0,1)}scale(t){return a.S(this.$.x,this.$.y,this.r*t)}}class o{constructor(t,i){this.x=t,this.y=i,this.H=[],this.K=[]}W;Y(t){return this.W=t,this}tt;H;K;parent;get position(){return new r(this.x,this.y)}it(t,i){this.K.push([t,i])}st(t){return this.H.filter((i=>i instanceof t))}et(t){return this.H.find((i=>i instanceof t))}ht(t,i,s,e){let h=new t(s,e);return h.parent=this,h.Y(i).init(),h}S(t,i={},s=0,e=s){let h=this.ht(t,i,s,e);return this.H.push(h),h}remove(t){if(!t)return void this.parent?.remove(this);let i=this.H.indexOf(t);if(-1===i)throw"noscene rm";this.H.splice(i,1)}init(){return this.tt=0,this.nt(),this}update(){0===this.tt&&this.rt(),this.H.forEach((t=>t.update())),this.tt+=n.N,this.K=this.K.map((([t,i])=>(t-n.N<0&&i(),[t-n.N,i]))).filter((t=>t[0]>0)),this.ot()}draw(t){this.lt(t),this.H.forEach((i=>i.draw(t))),this.ut(t),this.ct(t)}nt(){}rt(){}ot(){}ut(t){}lt(t){}ct(t){}}class l extends o{get data(){return this.W}get info(){let t=e.info.find((t=>t.name===this.dt));if(!t)throw`nosprite ${this.dt}`;return t}get duration(){return this.data.duration??.4}get tag(){let t=this.info.tags.find((t=>t.name===this.ft));if(!t)throw`notag ${this.dt} ${this.ft}`;return t}get dt(){return this.data.name}get ft(){return this.data.tag||"idle"}x=0;y=0;_t=1;gt=1;wt(t,i){this.x=t,this.y=i}_current_frame=0;get D(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get At(){return this.data.At??"c"}get F(){if("tl"===this.At)return 0;let{u:t}=this.D;return"c"===this.At||"bc"===this.At?t/2:0}get I(){if("tl"===this.At)return 0;let{_:t}=this.D;return"c"===this.At?t/2:"bc"===this.At?t:0}xt(t){this.data.tag=t,this._current_frame=0,this.Mt=0}Mt=0;ot(){let{from:t,to:i}=this.tag,{duration:s}=this,e=s/(i-t+1),h=i-t;this.Mt+=n.N,this.Mt>=e&&(this.Mt-=e,this._current_frame===h?this._current_frame=0:this._current_frame+=1)}ut(t){let{x:i,y:s,_t:e,gt:h}=this;t.k(this,i,s,e,h)}}const u=function(){let t=new Set;return document.addEventListener("keydown",(i=>(i=>{"ArrowUp"!==i.key&&"ArrowDown"!==i.key||i.preventDefault(),t.add(i.key)})(i))),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var c=function(){var t,i,s,e,h,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var e,h,n,a,l,u,c=o[t.vt[0]],d=t.vt[1],f=t.vt[3]/32,_=o[t.vt[4]],g=t.vt[5],m=t.vt[8]/32,p=t.vt[9],w=t.vt[10]*t.vt[10]*4,A=t.vt[11]*t.vt[11]*4,x=t.vt[12]*t.vt[12]*4,M=1/x,v=-t.vt[13]/16,y=t.vt[14],Q=s*2**(2-t.vt[15]),b=new Int32Array(w+A+x),U=0,V=0;for(e=0,h=0;e<w+A+x;e++,h++)h>=0&&(h-=Q,l=r(i+(15&(y=y>>8|(255&y)<<4))+t.vt[2]-128),u=r(i+(15&y)+t.vt[6]-128)*(1+8e-4*t.vt[7])),n=1,e<w?n=e/w:e>=w+A&&(n=(1-(n=(e-w-A)*M))*3**(v*n)),a=c(U+=l*n**f)*d,a+=_(V+=u*n**m)*g,p&&(a+=(2*Math.random()-1)*p),b[e]=80*a*n|0;return b},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.yt,s=0,e=n.Qt*n.bt*(i+1)*2,h=new Int32Array(e)},this.Ut=function(){var r,l,u,c,d,f,_,g,m,p,w,A,x,M,v=new Int32Array(e),y=t.Vt[s],Q=t.Qt,b=t.bt,U=0,V=0,B=!1,k=[];for(u=0;u<=i;++u)for(_=y.Bt[u],c=0;c<b;++c){var D=_?y.c[_-1].f[c]:0;D&&(y.vt[D-1]=y.c[_-1].f[c+b]||0,D<17&&(k=[]));var E=o[y.vt[16]],F=y.vt[17]/512,I=2**(y.vt[18]-9)/Q,C=y.vt[19],N=y.vt[20],P=43.23529*y.vt[21]*3.141592/44100,j=1-y.vt[22]/255,S=1e-5*y.vt[23],R=y.vt[24]/32,J=y.vt[25]/512,O=6.283184*2**(y.vt[26]-9)/Q,L=y.vt[27]/255,z=y.vt[28]*Q&-2;for(w=(u*b+c)*Q,d=0;d<4;++d)if(f=_?y.c[_-1].n[c+d*b]:0){k[f]||(k[f]=a(y,f,Q));var T=k[f];for(l=0,r=2*w;l<T.length;l++,r+=2)v[r]+=T[l]}for(l=0;l<Q;l++)(p=v[g=2*(w+l)])||B?(A=P,C&&(A*=E(I*g)*F+.5),V+=(A=1.5*Math.sin(A))*(x=j*(p-V)-(U+=A*V)),p=3==N?V:1==N?x:U,S&&(p=(p*=S)<1?p>-1?n(.25*p):-1:1,p/=S),B=(p*=R)*p>1e-5,M=p*(1-(m=Math.sin(O*g)*J+.5)),p*=m):M=0,g>=z&&(M+=v[g-z+1]*L,p+=v[g-z]*L),v[g]=0|M,v[g+1]=0|p,h[g]+=0|M,h[g+1]+=0|p}return++s/t.kt},this.Dt=function(t){for(var i=t.createBuffer(2,e/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<e;r+=2)n[r>>1]=h[r]/65536;return i}};const d={Vt:[{vt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],Bt:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{vt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],Bt:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{vt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],Bt:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],Qt:7350,bt:32,yt:22,kt:3},f=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},e=[{name:"song",data:d}];return{Ut:()=>(e.forEach((i=>{let e=new c;e.init(i.data),function h(){if(1===e.Ut()){let h=e.Dt(t);((t,i)=>{s[t]=i})(i.name,h)}else setTimeout(h,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==e.length?setTimeout(i,100):t()}()}))),play:(e,h=!1)=>{const n=s[e];if(!n)return;let r=t.createBufferSource(),a=t.createGain();return r.buffer=n,r.connect(a),a.connect(i),r.loop=h,a.gain.value=.8,r.start(),()=>{r.stop()}}}}();function _(t,i){let s=i*i/(t*t);return s=s>1?1:Math.sqrt(s),t*s}class g{constructor(t){this.Et=t,this.force=r.R,this.x=r.S(t.Ft,t.It),this.Ft=this.x,this.Ct=r.R,this.Nt=this.Et.Pt}force;x;Ft;Ct;Nt;update(t,i){let{Et:{jt:s,St:e,Pt:h}}=this,{force:n,x:a,Ft:o}=this,l=n.scale(1/e);l.x=_(l.x,h),l.y=_(l.y,h);let u=a.sub(o).scale(s*t/i).add(l.scale(t*(t+i)/2)),c=a,d=a.add(u);this.Ft=c,this.x=d,this.Ct=u,this.force=r.R,this.Nt=h}Rt(t){let i=Math.min(this.Nt,t.length);this.Nt-=i,t=t.normalize.scale(i),this.force=this.force.add(t)}get position(){return this.x}get Jt(){return this.Ct}get heading(){let t=this.Jt.normalize;return 0===t.length?r.unit:t}get Ot(){return this.heading.T}get Lt(){return this.Et.Lt}}class m{constructor(t,i){this.zt=i,this.body=new g(t)}static Tt=t=>r.R;static qt=t=>i=>function(t,i,s){let e=t.sub(i),h=e.scale(e.length<200?1:-1).normalize;return e.T.normalize.add(h).scale(s/2)}(i.position,t,i.Lt);static Zt=t=>i=>function(t,i,s){let e=r.R;return i.forEach((i=>{let s=t.sub(i);e=e.add(s.normalize.scale(1/(s.length||.1)))})),e.scale(15*s)}(i.position,t,i.Lt);static Gt=(t,i=0)=>s=>function(t,i,s,e){return p(t,i.$,s,e,1.2*i.r)}(s.position,t,s.Lt,i);static Xt=(t,i=0,s=100)=>e=>p(e.position,t,e.Lt,i,s);static $t=(t,i=100)=>s=>function(t,i,s,e){let h=i.sub(t),n=h.length;if(n<20)return r.R;let a=s*(n/e),o=Math.min(a,s);return h.scale(o/n)}(s.position,t,s.Lt,i);get position(){return this.body.position}body;get Et(){return this.body.Et}set Et(t){this.body.Et=t}update(t,i){this.zt.forEach((([t,i])=>{let s=t(this.body).sub(this.body.Jt).scale(this.Et.Pt/this.Et.Lt);this.body.Rt(s.scale(i))})),this.body.update(t,i)}}function p(t,i,s,e,h){let n=t.sub(i);return n.length>h?r.R:(0===n.length&&(n=n.X(e)),n.normalize.scale(s))}function w(t,i,s=.1){return(1-s)*t+s*i}function A(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function x(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function M(t){let i;const s=e=>{i=new e(0,0),i.Y({g:t,go:s}),i.init()};s(y),function(t){let i;const s=e=>{n.C=n.N,n.N=Math.min(20,Math.max(16,i?e-i:16))/1e3,i=e,n.time+=n.N,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),i.draw(t)}))}class v extends o{Ht=!1;Kt;get data(){return this.W}get g(){return this.data.g}go(t){this.data.go(t)}update(){u("m")?this.Ht||(this.Ht=!0,this.Kt?(this.Kt(),this.Kt=void 0):this.Kt=f.play("song",!0)):this.Ht=!1,super.update()}}class y extends v{nt(){e.load().then((()=>{this.S(l,{name:"loading",tag:"audio",duration:1e3},160,90),f.Ut().then((()=>{this.go(Q)}))}))}}class Q extends v{map;Wt;nt(){this.Kt=f.play("song",!0),this.map=this.S(U),this.Wt=this.S(b)}}class b extends o{nt(){for(let e=0;e<3;e++){let t=this.S(l,{name:"bar"});t.x=80+80*e,t.y=15}let t=this.S(l,{name:"bar",tag:"end"});t.x=60,t.y=15;let i=this.S(l,{name:"bar",tag:"end"});i.x=260,i.y=15,i._t=-1;let s=this.S(l,{name:"bar",tag:"middle"});s.x=160,s.y=15,this.Yt=this.S(l,{name:"bar",tag:"thumb"}),this.Yt.y=25}Yt;width=0;ot(){this.Yt.x=40+this.width/26*240}lt(t){t.fr(35,12,260,8,"red")}}class U extends o{get Wt(){return this.parent.Wt}w;t;o;ti=0;ii=0;si=0;ei=0;hi=0;ni=0;ri=0;ai=0;nt(){const t=e.h[0];this.w=t.w,this.t=t.t,this.o=Array(t.t);for(let i=0;i<t.t;i++)this.o[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:e}=t.i[i],h=s[0]/8,n=s[1]/8,r=e[1]/8*20+e[0]/8;399===r?this.S(I,{},s[0],s[1]):398===r?this.S(B,{},s[0],s[1]):this.o[n][h]=r}}oi(t,i,s){return!!this.li(t,i,s)}li(t,i,s){let{x:e,y:h,w:n,t:r}=t;return this.ui(e-n/2+i,h-r/2+s,n,r)}ui(t,i,s=1,e=1){let h=this.o[0].length,n=this.o.length,r=t/8,a=i/8,o=(t+s-1)/8,l=(i+e-1)/8;if(r<0||o>=h||a<0||l>=n)return!0;for(t=r;t<=o;t++)for(i=a;i<=l;i++)if(t=Math.floor(t),i=Math.floor(i),S(this.o[i][t]))return[8*t,8*i]}ot(){let t=this.et(I);if(t){if(t&&void 0===t.ci){let i=this.oi(t,0,4),s=this.li(t,1,-8)?void 0:this.li(t,1,0),e=this.li(t,-1,-8)?void 0:this.li(t,-1,0);i||(t.di&&Array.isArray(s)?(t.ci=.4,t.x=s[0],t.y=s[1]):t.fi&&Array.isArray(e)&&(t.ci=.4,t.x=e[0]+8,t.y=e[1]))}if(t&&void 0===t.ci&&void 0===t._i){let i=this.li(t,1,-8)?void 0:this.li(t,1,0),s=this.li(t,-1,-8)?void 0:this.li(t,-1,0);t.di&&Array.isArray(i)?(t._i=.16,t.x=i[0],t.y=i[1]-1):t.fi&&Array.isArray(s)&&(t._i=-.16,t.x=s[0]+8,t.y=s[1]-1)}let i=this.li(t,0,0);if(void 0!==t.ci&&(t.ci=A(t.ci,0,n.N),0===t.ci&&(t.ci=void 0,t.y=i[1]-8,t.dy=0)),void 0!==t._i)t._i=A(t._i,0,n.N),0===t._i&&(t._i=void 0,t.y=i[1]-8,t.dy=0);else{let i=9;{let s=Math.sign(t.dy),e=Math.abs(t.dy+t.gi);t.gi=e%1*s;for(let h=0;h<e;h+=1){let e=.5*s*n.N*n.N*20;if(this.oi(t,0,e)){t.mi=s,t.dy/=2;break}t.mi=0,t.y+=e;{let s=i,e=1;t.dy+=e*s*n.N}}}if(t.dy>-50){let s=2e3*i,e=1;for(let i=0;i<s;i+=1){let i=.5*e*n.N*n.N;if(this.oi(t,0,i)){t.mi=e,t.dy=0;break}t.mi=0,t.y+=i}}let s=Math.sign(t.dx),e=Math.abs(t.dx+t.pi);t.pi=e%1*s;let h=0===t.dy?1:.8,r=t.wi>0?.66:1;for(let o=0;o<e;o++){let i=s*n.N*10*h*r;if(this.oi(t,i,0)){t.Ai=s,t.dx=0;break}t.Ai=0,t.x+=i}this.si<t.x-8-30&&(this.si=t.x-8-30),this.si>t.x+8+30&&(this.si=t.x+8+30),this.ei<t.y-8-30&&(this.ei=t.y-8-30),this.ei>t.y+8+30&&(this.ei=t.y+8+30);let a=t.dx<0?-170:t.dx>0?-150:-160;this.ti=w(this.ti,this.si+a),this.ii=w(this.ii,this.ei-90,.5),this.ti=Math.min(Math.max(0,this.ti),8*this.w-320)}t.wi>0&&(this.ri=-1,this.ai=-.2)}let i=this.st(C);if(t){let s=this.et(F)?.position??r.R,e=this.st(E);e.forEach((t=>{let s=i.find((i=>x(t.xi,i.xi)));s&&(this.S(D,{name:"one_char",tag:"hit",duration:.8},t.x,t.y),t.remove(),s.Mi=!0,this.Wt.width++)})),e.forEach((i=>{i.yi([[m.Zt(e.filter((t=>t!==i)).map((t=>t.position))),.1],[m.$t(s,t.position.y),.2],[m.Gt(a.S(t.position.x,t.position.y,10)),.1]])}))}if(t){let s=this.st(F);s.forEach((t=>{let s=i.find((i=>x(t.xi,i.xi)));if(s){if(0===t.Qi){for(let i=0;i<2;i++)this.S(D,{name:"two_char",tag:"split",duration:.8,bi:[E,{}]},t.x,t.y);t.remove()}else t.Mi=.3;s.Mi=!0}})),s.forEach((i=>{i.Mi?(i.yi([[m.Gt(a.S(t.x,t.y,200)),.7],[m.Tt,.3]]),i.Ui(i.Vi)):(i.yi([[m.Zt(s.filter((t=>t!==i)).map((t=>t.position))),.1],[m.$t(t.position,8),.2],[m.$t(r.S(Math.abs(Math.sin(.2*this.tt))*this.w*8,t.position.y),8),.2],[m.Gt(a.S(t.x,t.y,90)),.4]]),i.Ui(i.Bi))}))}i.forEach((t=>{let i=Math.sign(t.dx),s=Math.abs(t.dx+t.pi);t.pi=s%1*i;for(let e=0;e<s;e++){let s=i*n.N*10;if(this.oi(t,s,0)){t.Ai=i,t.dx=0;break}t.Ai=0,t.x+=s}})),0!==this.ri&&(this.hi=this.ri*Math.sin(2*Math.PI*.2*this.tt),this.hi+=this.ri*Math.random()*1),0!==this.ai&&(this.ni=this.ai*Math.cos(2*Math.PI*100*n.N),this.ni+=this.ai*Math.random()),this.ri=A(this.ri,0,100*n.N),this.ai=A(this.ai,0,100*n.N)}lt(t){t.U(-this.ti+this.hi,-this.ii+this.ni)}ct(t){t.pop()}ut(t){for(let i=0;i<this.w;i++)for(let s=0;s<this.t;s++){let e=this.o[s][i];t.V(e,8*i,8*s)}}}class V extends o{k;w=16;t=16;dx=0;dy=0;pi=0;gi=0;Ai=0;mi=0;get xi(){let{x:t,y:i,w:s,t:e}=this;return{x:t-s/2,y:i-e/2,w:s,t:e}}lt(t){t.U(this.x,this.y)}ct(t){t.pop()}}class B extends V{nt(){this.parent.S(F,{},this.x,this.y)}ot(){this.parent.st(F).length<5&&n.P(1)&&this.parent.S(F,{},this.x,this.y)}}class k extends V{ki=[[m.Tt,1]];Di;init(){return this.Di=new m(this.Et,this.ki),super.init()}yi(t){this.ki.length=0,this.ki.push(...t)}Ui(t){this.Di.Et=t}update(){this.Di.update(n.N,n.C);let{x:t,y:i}=this.Di.position;this.x=t,this.y=i,super.update()}}class D extends V{get data(){return this.W}get duration(){return this.data.duration??1}nt(){let{name:t,tag:i}=this.data;this.k=this.S(l,{name:t,tag:i,duration:this.duration})}ot(){if(this.tt>this.duration){if(this.data.Ei?.(),this.data.bi){let[t,i]=this.data.bi;this.parent.S(t,i,this.x,this.y)}this.remove()}}}class E extends k{Et={St:.002,jt:.99,Lt:400,Pt:280,Ft:this.x,It:this.y};nt(){this.k=this.S(l,{name:"one_char"})}}class F extends k{w=32;t=32;Mi;Qi=2;Bi={St:.02,jt:.98,Lt:300,Pt:180,Ft:this.x,It:this.y};Vi={St:.001,jt:.8,Lt:5e3,Pt:2e3,Ft:this.x,It:this.y};Et=this.Bi;nt(){this.k=this.S(l,{name:"two_char"})}ot(){this.Mi?(this.k.xt("damage"),this.Mi=A(this.Mi,0,n.N),0===this.Mi&&(this.Mi=void 0,this.Qi-=1)):this.k.xt("idle")}}class I extends V{di=!1;fi=!1;ci;_i;Fi;Ii;Ci=2;wi=0;Ni=this.Pi;ji=this.y;get Si(){return this.ji>this.y}get Ri(){return this.ji<this.y}Ji=1;get Pi(){return this.mi>0}nt(){this.k=this.S(l,{name:"main_char"})}ot(){0!==this.dx&&(this.Ji=Math.sign(this.dx));let t=u("ArrowLeft")||u("a"),i=u("ArrowRight")||u("d"),s=u("ArrowUp")||u("w"),e=u(" ")||u("x");if(this.fi=t,this.di=i,t){let t=this.dx>0?40:30;this.dx=A(this.dx,-10,n.N*t)}else if(i){let t=this.dx<0?40:30;this.dx=A(this.dx,10,n.N*t)}else this.dx=A(this.dx,0,66*n.N);if(s?void 0!==this.Fi&&(this.Fi+=n.N):void 0===this.Fi?this.Fi=0:this.Fi>0&&(this.Fi=-.3),void 0!==this.Fi&&this.Fi<0&&(this.Fi+=n.N,this.Fi>=0&&(this.Fi=void 0)),void 0!==this.Fi&&this.Fi>0&&(void 0!==this.Ii?(this.dy=-2e3,this.Fi=void 0,this.Ci=1,f.play("jump")):this.Ci>0&&(this.dy=-2e3,this.Fi=void 0,this.Ci=0,f.play("djump"))),this.Pi?this.Ii=0:this.Ni&&(this.Ii=.16),void 0!==this.Ii&&this.Ii>0&&(this.Ii=A(this.Ii,0,n.N),0===this.Ii&&(this.Ii=void 0)),void 0!==this.ci?this.k.xt("ledge"):this.Pi?0!==this.dx?(this.k.xt("run"),this.k._t=this.Ji):this.k.xt("idle"):(this.Si?this.k.xt("jump"):this.k.xt("fall"),0!==this.Ji&&(this.k._t=this.Ji)),this.Si?(this.k._t=A(this.k._t,.8*this.Ji,.9*n.N),this.k.gt=A(this.k.gt,1.16,.9*n.N)):(this.k._t=A(this.k._t,this.Ji,n.N),this.k.gt=A(this.k.gt,1,n.N)),!this.ci&&!this._i&&e&&0===this.wi){let t=this.parent.S(N);t.x=this.x+this.dx,t.y=this.y-8*Math.random(),t.k._t=this.Ji;let i=this.parent.S(C);i.x=this.x,i.y=t.y,i.dx=10*this.Ji*2.5,i.k._t=Math.sign(i.dx),i.Oi=i.x,i.Li=(0===this.dx?60:110)+30*Math.random(),this.wi=.2}this.wi=A(this.wi,0,n.N),this.Ni=this.Pi,this.ji=this.y,this.k.x=-this.wi*this.Ji*12}}class C extends V{w=12;t=12;Oi=0;Li=120;Mi=!1;get G(){return Math.abs(this.x-this.Oi)}nt(){this.k=this.S(l,{name:"bullet",duration:.1}),this.dy=40*(.5-Math.random())}ot(){if(this.k.y+=this.dy*n.N,(this.G>this.Li||0!==this.Ai)&&(this.Mi=!0),this.Mi){let t=this.parent.S(P,{name:"bullet",tag:"hit"});t.x=this.x,t.y=this.y,t.k._t=this.k._t,this.remove()}}}class N extends V{nt(){this.k=this.S(l,{name:"bullet",tag:"flash"+(Math.random()<.4?"2":""),duration:.16})}ot(){this.tt>=.16&&this.remove()}}class P extends V{nt(){this.k=this.S(l,{name:"bullet",tag:"hit",duration:.4})}ot(){this.tt>=.4&&this.remove()}}const j=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],S=t=>j.includes(t);!function(t){let i=function(t,i,s=!0){let e=document.createElement("canvas");s&&e.classList.add("pixelated");let n=e.getContext("2d");const r=()=>{e.width=t,e.height=i,n.imageSmoothingEnabled=!s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new h(e,n)}(320,180,!0);t.appendChild(i.canvas),M(i)}(document.getElementById("app"));
