const t=""+new URL("out_0-CzUBtKHx.png",import.meta.url).href,i=[{n:"Level_0",y:-208,w:325,t:49,i:"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"}];function s(t){function i(t){function i(t){return[8*(t%1024),8*Math.floor(t/1024)]}let s=[],h=function(t){const i=atob(t),s=i.length,h=new Uint8Array(s);for(let e=0;e<s;e++)h[e]=i.charCodeAt(e);return new Uint16Array(h.buffer)}(t);for(let e=0;e<h.length;){let t=h[e];e++;let n=h[e];e++;let r=[...h.slice(e,e+n)];e+=n,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,y:h,w:e,t:n,i:r}=t;return{name:s,y:h,w:e,t:n,i:i(r)}}))}const h=new class{image;info;h;l;async load(){var h;this.image=await(h=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=h}))),this.info="bullet\n\n0*2*key\n3*6*idle\n7*9*hit\n10*11*flash\n12*13*flash2\n14*17*damage\n\n0*160*80\n0*128*32\n0*144*32\n0*160*32\n0*144*0\n0*160*0\n0*144*16\n0*160*16\n0*48*62\n0*64*62\n0*80*62\n0*96*62\n0*112*62\n0*128*62\n0*144*62\n0*160*62\n0*0*110\n0*16*110\n\n\ndoor\n\n0*0*idle\n1*2*open\n\n5*48*0\n5*80*0\n5*112*0\n\n\nfx\n\n0*1*djump\n\n0*32*110\n0*48*110\n\n\nloading\n\n0*0*audio\n1*2*input\n\n4*48*32\n4*0*80\n4*80*80\n\n\nmain_char\n\n0*1*idle\n2*6*run\n7*10*jump\n11*14*fall\n15*17*ledge\n18*19*knock\n20*21*skid\n22*23*die\n24*24*dead\n\n0*64*110\n0*80*110\n0*96*110\n0*112*110\n0*128*110\n0*144*110\n0*160*110\n0*0*126\n0*16*126\n0*32*126\n0*48*126\n0*64*126\n0*80*126\n0*96*126\n0*112*126\n0*128*126\n0*144*126\n0*160*126\n0*0*142\n0*16*142\n0*32*142\n0*48*142\n0*64*142\n0*80*142\n0*96*142\n\n\nplus_char\n\n0*1*idle\n2*4*jumped\n5*6*damage\n7*9*sleep\n10*11*cover\n12*14*cover_hit\n15*16*ear\n17*19*wgro\n\n0*112*142\n0*128*142\n0*144*142\n0*160*142\n0*0*158\n0*16*158\n0*32*158\n0*48*158\n0*64*158\n0*80*158\n0*96*158\n0*112*158\n0*128*158\n0*144*158\n0*160*158\n0*0*174\n0*16*174\n0*32*174\n0*48*174\n0*64*174\n\n\ntiles\n\n0*0*idle\n\n3*0*0\n\n\nwgrofire\n\n0*2*idle\n\n0*80*174\n0*96*174\n0*112*174".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,h]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,h]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:h}})),o:h.split(/\r?\n/).map((t=>{let[i,s,h,e,n,r,a,l]=function(t){let[i,s,h]=t,e=0,n=0,[r,a]=0===i?[16,16]:1===i?[32,16]:2===i?[80,80]:3===i?[160,160]:4===i?[80,30]:5===i?[32,32]:[0,0],[l,o]=[r,a];return[e,n,r,a,s,h,l,o]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:h,A:e,_:n,m:r,M:a,p:l}}))}})),this.l=this.info.find((t=>"tiles"===t.name)).o[0],this.h=s(i)}v(t){return this.h.filter((i=>i.y===128*t))}};class e{constructor(t,i){this.canvas=t,this.B=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{B:t}=this;t.clearRect(0,0,this.width,this.height)}D({x:t,y:i,w:s,t:h}){this.fr(t,i,s,h,"red")}fr(t,i,s,h,e){let{B:n}=this;n.fillStyle=e,n.fillRect(t,i,s,h)}k(t,i){let{B:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{B:t}=this;t.restore()}I(t,i,s){let{fx:e,fy:n,_:r,m:a}=h.l,l=i-e,o=s-n,d=t%6*8,u=8*Math.floor(t/6);this.U(l,o,r+d,a+u,8,8)}C(t,i,s,h=1,e=1){let{fx:n,fy:r,_:a,m:l,M:o,p:d}=t.N,{T:u,R:A}=t,w=i-n-u,c=s-r-A;this.U(w,c,a,l,o,d,h,e)}U(t,i,s,e,n,r,a=1,l=1){let{B:o}=this,{image:d}=h;o.save();let u=n,A=r,w=u*Math.abs(a),c=A*Math.abs(l);o.scale(Number(a.toFixed(2)),Number(l.toFixed(2))),a<0&&(t*=-1,t-=w),l<0&&(i*=-1,i-=c),o.drawImage(d,s,e,u,A,Math.round(t),Math.round(i),Math.round(w),Math.round(c)),o.restore()}}const n={H:16,j:16,time:0,S:0,F(t,i=0){let{j:s,time:h}=this;return Math.floor((h-i-s)/t)<Math.floor((h-i)/t)}};class r{constructor(t,i){this.x=t,this.y=i,this.J=[],this.L=[]}P;X(t){return this.P=t,this}K;J;L;parent;get position(){return[this.x,this.y]}G(t,i){this.L.push([t,i])}O(t){return this.J.filter((i=>i instanceof t))}Y(t){return this.J.find((i=>i instanceof t))}Z(t,i,s,h){let e=new t(s,h);return e.parent=this,e.X(i).init(),e}q(t,i={},s=0,h=s){let e=this.Z(t,i,s,h);return this.J.push(e),e}remove(t){if(!t)return void this.parent?.remove(this);let i=this.J.indexOf(t);if(-1===i)throw"noscene rm";this.J.splice(i,1)}init(){return this.K=0,this.V(),this}update(){0===this.K&&this.W(),this.J.forEach((t=>t.update())),this.K+=n.j,this.L=this.L.map((([t,i])=>(t-n.j<0&&i(),[t-n.j,i]))).filter((t=>t[0]>0)),this.$()}visible=!0;draw(t){this.visible&&(this.tt(t),this.J.forEach((i=>i.draw(t))),this.it(t),this.st(t))}V(){}W(){}$(){}it(t){}tt(t){}st(t){}}class a extends r{get data(){return this.P}get info(){let t=h.info.find((t=>t.name===this.ht));if(!t)throw`nosprite ${this.ht}`;return t}get duration(){return this.data.duration??.4}get tag(){let t=this.info.tags.find((t=>t.name===this.et));if(!t)throw`notag ${this.ht} ${this.et}`;return t}get ht(){return this.data.name}get et(){return this.data.tag||"idle"}nt=1;rt=1;lt(t,i){this.x=t,this.y=i}_current_frame=0;get N(){let{from:t}=this.tag;return this.info.o[this._current_frame+t]}get ot(){return this.data.ot??"c"}get T(){if("tl"===this.ot)return 0;let{u:t}=this.N;return"c"===this.ot||"bc"===this.ot?t/2:0}get R(){if("tl"===this.ot)return 0;let{A:t}=this.N;return"c"===this.ot?t/2:"bc"===this.ot?t:0}dt(t){this.data.tag!==t&&(this.data.tag=t,this._current_frame=0,this.ut=0)}loop=!0;ut=0;$(){let{from:t,to:i}=this.tag,{duration:s}=this,h=s/(i-t+1),e=i-t;this.ut+=n.j,this.ut>=h&&(this.ut-=h,this._current_frame===e?this.loop&&(this._current_frame=0):this._current_frame+=1)}it(t){let{x:i,y:s,nt:h,rt:e}=this;t.C(this,i,s,h,e)}}const l=function(){let t=new Set;return document.addEventListener("keydown",(i=>(i=>{"ArrowUp"!==i.key&&"ArrowDown"!==i.key||i.preventDefault(),t.add(i.key)})(i))),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var o=function(){var t,i,s,h,e,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var h,e,n,a,o,d,u=l[t.At[0]],A=t.At[1],w=t.At[3]/32,c=l[t.At[4]],_=t.At[5],f=t.At[8]/32,g=t.At[9],m=t.At[10]*t.At[10]*4,M=t.At[11]*t.At[11]*4,p=t.At[12]*t.At[12]*4,x=1/p,y=-t.At[13]/16,E=t.At[14],v=s*2**(2-t.At[15]),B=new Int32Array(m+M+p),D=0,k=0;for(h=0,e=0;h<m+M+p;h++,e++)e>=0&&(e-=v,o=r(i+(15&(E=E>>8|(255&E)<<4))+t.At[2]-128),d=r(i+(15&E)+t.At[6]-128)*(1+8e-4*t.At[7])),n=1,h<m?n=h/m:h>=m+M&&(n=(1-(n=(h-m-M)*x))*3**(y*n)),a=u(D+=o*n**w)*A,a+=c(k+=d*n**f)*_,g&&(a+=(2*Math.random()-1)*g),B[h]=80*a*n|0;return B},l=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.wt,s=0,h=n.ct*n._t*(i+1)*2,e=new Int32Array(h)},this.ft=function(){var r,o,d,u,A,w,c,_,f,g,m,M,p,x,y=new Int32Array(h),E=t.gt[s],v=t.ct,B=t._t,D=0,k=0,Q=!1,I=[];for(d=0;d<=i;++d)for(c=E.Mt[d],u=0;u<B;++u){var U=c?E.c[c-1].f[u]:0;U&&(E.At[U-1]=E.c[c-1].f[u+B]||0,U<17&&(I=[]));var C=l[E.At[16]],N=E.At[17]/512,T=2**(E.At[18]-9)/v,b=E.At[19],R=E.At[20],H=43.23529*E.At[21]*3.141592/44100,j=1-E.At[22]/255,S=1e-5*E.At[23],F=E.At[24]/32,J=E.At[25]/512,L=6.283184*2**(E.At[26]-9)/v,P=E.At[27]/255,z=E.At[28]*v&-2;for(m=(d*B+u)*v,A=0;A<4;++A)if(w=c?E.c[c-1].n[u+A*B]:0){I[w]||(I[w]=a(E,w,v));var X=I[w];for(o=0,r=2*m;o<X.length;o++,r+=2)y[r]+=X[o]}for(o=0;o<v;o++)(g=y[_=2*(m+o)])||Q?(M=H,b&&(M*=C(T*_)*N+.5),k+=(M=1.5*Math.sin(M))*(p=j*(g-k)-(D+=M*k)),g=3==R?k:1==R?p:D,S&&(g=(g*=S)<1?g>-1?n(.25*g):-1:1,g/=S),Q=(g*=F)*g>1e-5,x=g*(1-(f=Math.sin(L*_)*J+.5)),g*=f):x=0,_>=z&&(x+=y[_-z+1]*P,g+=y[_-z]*P),y[_]=0|x,y[_+1]=0|g,e[_]+=0|x,e[_+1]+=0|g}return++s/t.xt},this.yt=function(t){for(var i=t.createBuffer(2,h/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<h;r+=2)n[r>>1]=e[r]/65536;return i}};const d=(t,i,s)=>({At:t,Mt:i,c:s}),u=(t,i)=>i.map((i=>({gt:[d(t,[1],[{n:[i],f:[]}])],ct:5513,_t:32,wt:0,xt:1}))),A={gt:[{At:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],Mt:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{At:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],Mt:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{At:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],Mt:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],ct:7350,_t:32,wt:22,xt:3},w=u([3,63,128,36,0,166,112,181,25,3,4,4,67,32,156,1,0,195,6,0,3,51,186,127,212,0,2,29,3],[135,125]),c=u([1,63,104,51,1,140,104,0,47,49,11,24,79,144,108,5,0,195,6,0,2,64,92,174,124,19,4,56,3],[149,158,150]),_=u([1,63,130,0,0,87,130,0,0,12,8,15,40,144,104,5,0,195,6,0,2,64,92,174,124,19,4,63,2],[135,137,139]),f=u([1,206,96,20,3,204,104,23,23,11,27,49,72,104,51,5,1,231,13,0,2,38,157,51,32,4,4,119,2],[139]),g=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},h=[{name:"song",data:A},{name:"bullet0",data:w[0]},{name:"bullet1",data:w[1]},{name:"damage0",data:c[0]},{name:"damage1",data:c[1]},{name:"damage2",data:c[2]},{name:"jump0",data:_[0]},{name:"jump1",data:_[1]},{name:"jump2",data:_[2]},{name:"knock",data:f[0]}];return{ft:()=>(h.forEach((i=>{let h=new o;h.init(i.data),function e(){if(1===h.ft()){let e=h.yt(t);((t,i)=>{s[t]=i})(i.name,e)}else setTimeout(e,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==h.length?setTimeout(i,100):t()}()}))),play:(h,e=!1)=>{const n=s[h];if(!n)return;let r=t.createBufferSource(),a=t.createGain();return r.buffer=n,r.connect(a),a.connect(i),r.loop=e,a.gain.value=.8,r.start(),()=>{r.stop()}}}}();const m=10;let M,p=.2;function x(t,i,s=.1){return(1-s)*t+s*i}function y(t,i,s=n.j){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function E(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function v(t){let i;const s=h=>{i?.Et?.(),i=new h(0,0),i.X({g:t,go:s}),i.init()};s(D),function(t){let i;const s=h=>{n.H=n.j,n.j=Math.min(20,Math.max(16,i?h-i:16))/1e3,n.S>0&&(n.S-=n.j,n.j*=.5),i=h,n.time+=n.j,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,320,180,"#fafafa"),t.fr(1,1,318,178,"#1f1f1f"),i.draw(t)}))}class B extends r{vt=!1;Et;get data(){return this.P}get g(){return this.data.g}go(t){this.data.go(t)}update(){l("m")?this.vt||(this.vt=!0,this.Et?(this.Et(),this.Et=void 0):this.Et=g.play("song",!0)):this.vt=!1,super.update()}}class D extends B{V(){h.load().then((()=>{this.q(a,{name:"loading",tag:"audio",duration:1e3},160,90),g.ft().then((()=>{this.go(k)}))}))}}class k extends B{map;V(){this.Et=g.play("song",!0),this.map=this.q(Q)}$(){this.map.Y(R).Bt>3&&this.go(k)}}class Q extends r{w;t;l;Dt=0;kt=0;Qt=0;It=0;Ut=0;Ct=0;Nt=0;Tt=0;get bt(){return{x:Math.max(0,Math.floor(this.Dt-80)),y:Math.max(0,Math.floor(this.kt-30)),w:480,t:240}}get Rt(){let{x:t,y:i,w:s,t:h}=this.bt;return t=Math.floor(t/8),i=Math.floor(i/8),{x:t,y:i,Ht:Math.min(this.w,Math.floor(t+s/8+2)),jt:Math.min(this.t,Math.floor(i+h/8+2))}}V(){const t=h.h[0];this.w=t.w,this.t=t.t,this.l=Array(t.t);for(let i=0;i<t.t;i++)this.l[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:h}=t.i[i],e=s[0]/8,n=s[1]/8,r=h[1]/8*6+h[0]/8;11===r?(M&&(s=M),this.q(R,{},s[0],s[1])):17===r?this.q(C,{},s[0],s[1]):23===r?this.q(U,{},s[0],s[1]):this.l[n][e]=r}}St(t,i,s){return!!this.Ft(t,i,s)}Ft(t,i,s){let{x:h,y:e,w:n,t:r}=t;return this.Jt(h-n/2+i,e-r/2+s,n,r)}Jt(t,i,s=1,h=1){let e=this.l[0].length,n=this.l.length,r=t/8,a=i/8,l=(t+s-1)/8,o=(i+h-1)/8;if(r<0||l>=e||a<0||o>=n)return!0;for(t=r;t<=l;t++)for(i=a;i<=o;i++)if(t=Math.floor(t),i=Math.floor(i),S(this.l[i][t]))return[8*t,8*i]}$(){let t=this.Y(R),i=this.O(U),s=i.find((i=>E(i.Lt,t.Pt)));if(s&&(s.zt?M=[s.x-12,s.y+8]:(t.dx=0,t.dy=0)),0===t.Xt){let i=this.St(t,0,4),s=this.Ft(t,1,-8)?void 0:this.Ft(t,1,0),h=this.Ft(t,-1,-8)?void 0:this.Ft(t,-1,0);i||(t.Kt&&Array.isArray(s)?(t.Xt=.4,t.x=s[0],t.y=s[1]):t.Gt&&Array.isArray(h)&&(t.Xt=.4,t.x=h[0]+8,t.y=h[1]))}if(0===t.Xt&&0===t.Ot){let i=this.Ft(t,1,-8)?void 0:this.Ft(t,1,0),s=this.Ft(t,-1,-8)?void 0:this.Ft(t,-1,0);t.Kt&&Array.isArray(i)?(t.Ot=.13,t.x=i[0],t.y=i[1]-1):t.Gt&&Array.isArray(s)&&(t.Ot=-.13,t.x=s[0]+8,t.y=s[1]-1)}let h=this.Ft(t,0,0);t.Xt&&(t.Xt=y(t.Xt,0),0===t.Xt&&(t.y=h[1]-8,t.dy=0)),t.Ot&&(t.Ot=y(t.Ot,0),0===t.Ot&&(t.y=h[1]-8,t.dy=0)),t.Yt>0&&(0===this.Nt&&(this.Nt=-1),0===this.Tt&&(this.Tt=-.2)),this.Qt<t.x-8-30&&(this.Qt=t.x-8-30),this.Qt>t.x+8+30&&(this.Qt=t.x+8+30),this.It<t.y-8-30&&(this.It=t.y-8-30),this.It>t.y+8+30&&(this.It=t.y+8+30);let e=t.dx<0?-170:t.dx>0?-150:-160;this.Dt=x(this.Dt,this.Qt+e),this.kt=x(this.kt,this.It-90,.5),this.Dt=Math.min(Math.max(0,this.Dt),8*this.w-320),this.O(I).filter((t=>E(t,this.bt))).forEach((t=>{{0===t.dx&&(t.Zt=0),0===t.dy&&(t.qt=0);let i=t.Vt,s=Math.sign(t.dx+t.Zt),h=Math.abs(t.dx+t.Zt)*n.j*10*i;t.Zt=h%1*s;for(let e=0;e<h;e++){let i=s;if(this.St(t,i,0)){t.Wt=s,t.dx=0;break}t.Wt=0,t.x+=i}}{let i=9.8;{let s=Math.sign(t.dy+t.qt),h=1*Math.abs(t.dy+t.qt)/2*n.j*n.j*3200;t.qt=h%1*s;for(let e=0;e<h;e+=1){let h=s;if(this.St(t,0,h)){t.$t=s,t.dy/=2,t.qt=0;break}{t.$t=0,t.y+=h;let s=t.ti;t.dy=y(t.dy,0,n.j*i*s)}}}let s=t.ii;if(t.dy>-7){let h=2800*i*s*1/2*n.j*n.j,e=1;for(let i=0;i<h;i+=1){let i=e;if(this.St(t,0,i)){t.$t=e,t.dy=0;break}t.$t=0,t.y+=i}}}}));let r=this.O(C);r.forEach((i=>{i.si&&i.hi>0&&(i.si=!1,t.si=!0)})),r.forEach((i=>{t.ei||t.ni||(t.ri&&E(i.Lt,t.ai)&&(i.li=.3,t.dy=-20.8,g.play("jump0"),i.dy=-4.8),i.oi&&(E(i.di,t.Lt)&&(i.ui=.3),E(i.Ai,t.Lt)&&(i.wi=.2)))}));let a=this.O(T);if(!t.ei&&!t.ni){let i=!1;Math.floor(t.y)===8*this.t-t.t/2?i=!0:a.forEach((s=>{E(s.Lt,t.ci)&&(i=!0)})),i&&(g.play("knock"),n.S=2.2,t.ni=2.2,t.dy=-9.6,t.dx=-1*t._i*m*3.2,this.Nt=8,this.Tt=8)}let l=this.O(H);console.log(this.Tt),i.filter((t=>!t.zt)).forEach((i=>{let s=l.filter((t=>!t.fi)).find((t=>E(i.Lt,t.Lt)));s&&(s.fi=!0,s.data.si&&(g.play("knock"),g.play("jump0"),g.play("jump1"),this.Nt=1,this.Tt=8,i.zt=!0,t.si=!1))})),r.forEach((t=>{let i=l.filter((t=>!t.fi)).find((i=>E(t.Lt,i.Lt)));i&&(0===t.hi&&(t.fi=.2,t.ui>0&&0===t.gi||(t.dx=1.2*i.dx,t.dy=-3.2,g.play("damage"+Math.floor(3*Math.random())),t.q(b,{name:"bullet",tag:"damage",duration:.4}))),i.fi=!0)})),0!==this.Nt&&(this.Ut=2*Math.sin(2*Math.PI*2*this.K),this.Ut+=Math.sin(2*Math.PI*2*(this.K+this.Nt)),this.Ut+=2*Math.random()),0!==this.Tt&&(this.Ct=Math.cos(2*Math.PI*1*this.K+1),this.Ct+=2*Math.random()),this.Nt=y(this.Nt,0,10*n.j),this.Tt=y(this.Tt,0,10*n.j)}tt(t){t.k(-this.Dt+this.Ut,-this.kt+this.Ct)}st(t){t.pop()}it(t){let{x:i,y:s,Ht:h,jt:e}=this.Rt;for(let n=i;n<h;n++)for(let i=s;i<e;i++){let s=this.l[i][n];t.I(s,8*n,8*i)}}}class I extends r{C;w=16;t=16;dx=0;dy=0;Zt=0;qt=0;Wt=0;$t=0;_i=1;get Vt(){return 1}get ii(){return 1}get ti(){return 1}get Lt(){let{x:t,y:i,w:s,t:h}=this;return{x:t-s/2,y:i-h/2,w:s,t:h}}tt(t){t.k(this.x,this.y)}st(t){t.pop()}update(){0!==this.dx&&(this._i=Math.sign(this.dx)),super.update()}}class U extends I{zt=!1;get Lt(){let{x:t,y:i,w:s,t:h}=super.Lt;return{x:t+4,y:i+16,w:s,t:h}}w=8;t=32;V(){this.C=this.q(a,{name:"door",ot:"tl"},-8,0)}$(){this.zt&&(this.C.dt("open"),this.C.loop=!1)}}class C extends I{si=!0;hi=0;li=0;fi=0;ui=0;wi=0;mi=0;Mi=4;pi=.6;gi=0;get Ai(){return{x:this._i<0?this.x+8:this.x-50-8,y:this.y,w:50,t:4}}get di(){return{x:this._i<0?this.x-70-8:this.x+8,y:this.y,w:70,t:4}}get oi(){return this.fi+this.li+this.ui+this.wi===0}V(){this.C=this.q(a,{name:"plus_char"})}$(){if(this.Wt&&(this._i=-1*this._i),this.li&&(this.li=y(this.li,0)),this.hi)this.hi=y(this.hi,0),this.dx=0,this.C.dt("sleep");else if(this.fi)this.fi=y(this.fi,0),this.ui>0&&0===this.gi?(this.dx=y(this.dx,0,200*n.j),this.C.dt("cover_hit"),this.C.x=this.fi*this._i*-1*12):(this.dx=y(this.dx,(this.Mi<1?this._i:-this._i)*m*.58,200*n.j),this.C.dt("damage"),this.C.rt=y(this.C.rt,1.2,2*n.j),this.C.nt=y(this.C.nt,.8,2*n.j),0===this.fi&&(this.Mi-=1,this.Mi<0&&(this.Mi=4,this.hi=10)));else if(this.li)this.C.rt=y(this.C.rt,.8,1.8*n.j),this.C.nt=y(this.C.nt,1.2,1.6*n.j),this.C.dt("jumped");else if(this.ui){if(this.ui=y(this.ui,0),this.dx=y(this.dx,0,8*n.j),this.pi>0)this.pi=y(this.pi,0);else{this.gi=1,this.pi=1.6+Math.random(),this.parent.q(N,{},this.x,this.y).dx=this._i}this.gi?(this.gi=y(this.gi,0),this.C.dt("wgro")):this.C.dt("cover")}else this.wi?(this.wi=y(this.wi,0),this.dx=y(this.dx,0,8*n.j),this.C.dt("ear"),0===this.wi&&(this._i=-1*this._i)):this.mi?this.mi=y(this.mi,0):(this.dx=this._i*m*.58,this.C.dt("idle"));this.fi&&this.li||(this.C.rt=y(this.C.rt,1),this.C.nt=y(this.C.nt,1))}}class N extends I{xi=0;yi=.16;$(){if(this.yi>0&&(this.yi=y(this.yi,0)),0===this.yi){this.yi=.16,this.parent.q(T,{},this.x+this.xi,this.y-16).dy=-2.88,this.xi+=8*this._i}this.K>2.1&&this.remove()}}class T extends I{V(){this.C=this.q(a,{name:"wgrofire",duration:.7})}$(){this.K>.7&&this.remove()}}class b extends I{get Vt(){return 0}get ii(){return 0}get data(){return this.P}get duration(){return this.data.duration??1}V(){let{name:t,tag:i}=this.data;this.C=this.q(a,{name:t,tag:i,duration:this.duration}),this.C.nt=this.data.scale??1}$(){if(this.K>=this.duration){if(this.data.Ei?.(),this.data.Bi){let[t,i]=this.data.Bi;this.parent.q(t,i,this.x,this.y)}this.remove()}}}class R extends I{si=!0;get Pt(){let{x:t,y:i,w:s,t:h}=this.Lt;return{x:t+this.dx+this.Zt,y:i+this.dy+this.qt,w:s,t:h}}Kt=!1;Gt=!1;Xt=0;Ot=0;ni=0;Bt=-1;Di;ki;Qi=2;Yt=0;Mi=0;Ii=this.Ui;Ci=this.y;get ai(){return{x:this.Lt.x,y:this.Lt.y,w:1.2*this.w,t:this.t}}get ci(){return{x:this.Lt.x,y:this.Lt.y,w:.8*this.w,t:.7*this.t}}get Ni(){return this.Ci>this.y}get ri(){return this.Ci<this.y}get Vt(){return(0===this.dy?1:.8)*(this.Yt>0?.66:1)*(this.ni?1.2:1)}get ii(){return(this.Yt>0?.36:1)*(this.ni?.4:1)}get Ui(){return this.$t>0}get ei(){return this.Bt>=0}V(){this.C=this.q(a,{name:"main_char"})}$(){n.F(1)&&(p=Math.min(1,p+.01)),this.ni&&(this.ni=y(this.ni,0),0===this.ni&&0===this.Mi&&(this.Bt=0)),this.Bt>=0&&(this.Bt+=n.j);let t=l("ArrowLeft")||l("a"),i=l("ArrowRight")||l("d"),s=l("ArrowUp")||l("w"),h=l(" ")||l("x");if((this.ei||this.ni&&(0===this.Mi||this.ni>1.8))&&(t=!1,i=!1,s=!1,h=!1),this.Gt=t,this.Kt=i,t&&i||!t&&!i)this.dx=y(this.dx,0,70*n.j);else if(t){"skid"!==this.C.et&&this.dx>0&&this.dx<6&&(this.dx=0);let t=this.dx>0?40:30;this.dx=y(this.dx,-10,n.j*t)}else if(i){"skid"!==this.C.et&&this.dx<0&&this.dx>-6&&(this.dx=0,this.Zt=0);let t=this.dx<0?40:30;this.dx=y(this.dx,m,n.j*t)}if(s?void 0!==this.Di&&(this.Di+=n.j):void 0===this.Di?this.Di=0:this.Di>0&&(this.Di=-.16),void 0!==this.Di&&this.Di<0&&(this.Di+=n.j,this.Di>=0&&(this.Di=void 0)),this.Ui?this.ki=0:-1!==this.ki&&this.Ii&&(this.ki=.16),void 0!==this.Di&&this.Di>0&&(void 0!==this.ki&&this.ki>=0?(this.dy=-16,this.Di=void 0,this.ki=-1,this.Qi=1,g.play("jump0")):this.Qi>0&&(this.dy=-12.8,this.Di=void 0,this.Qi=0,g.play("jump"+(Math.random()<.3?"1":"2")),this.parent.q(b,{name:"fx",tag:"djump",duration:.3},this.x,this.y+5))),void 0!==this.ki&&this.ki>0&&(this.ki=y(this.ki,0),0===this.ki&&(this.ki=void 0)),this.ei?this.C.dt("dead"):this.ni?0===this.Mi?this.C.dt("die"):(this.C.dt("knock"),this.visible=this.ni%.26<.1):this.Xt?this.C.dt("ledge"):this.Ui?0!==this.dx?(Math.abs(this.dx)>2&&(this._i<0&&i||this._i>0&&t)?this.C.dt("skid"):this.C.dt("run"),this.C.nt=this._i):this.C.dt("idle"):this.Ni?this.C.dt("jump"):this.C.dt("fall"),Math.sign(this.C.nt)!==this._i&&(this.C.nt*=-1),this.Ni?(this.C.nt=y(this.C.nt,.8*this._i,.9*n.j),this.C.rt=y(this.C.rt,1.16,.9*n.j)):(this.C.nt=y(this.C.nt,this._i),this.C.rt=y(this.C.rt,1)),!this.Xt&&!this.Ot&&h&&0===this.Yt){let t=this.parent.q(b,{name:"bullet",tag:"flash"+(Math.random()<.4?"2":""),duration:.16});t.x=this.x+this.dx,t.y=this.y-8*Math.random(),t.C.nt=this._i;let i=this.parent.q(H,{si:this.si},this.x,t.y);i.dx=this._i*m*2.5,i.C.nt=Math.sign(i.dx),i.Ti=i.x,i.bi=(0===this.dx?60:110)+30*Math.random(),this.Yt=.2}this.Yt=y(this.Yt,0),this.Ii=this.Ui,this.Ci=this.y,this.C.x=-this.Yt*this._i*12}}class H extends I{get data(){return this.P}w=12;t=12;Ti=0;bi=120;fi=!1;get Ri(){return Math.abs(this.x-this.Ti)}get ii(){return 0}get ti(){return.1}V(){this.C=this.q(a,{name:"bullet",tag:this.data.si?"key":"idle",duration:.1});let t=2*(.5-Math.random());this.dy=(1-p)*t*-1.216,g.play("bullet"+(Math.abs(t)>.5?"0":"1"))}$(){(this.Ri>this.bi||0!==this.Wt)&&(this.fi=!0),this.fi&&(this.parent.q(b,{name:"bullet",tag:"hit",duration:.4,scale:this.C.nt},this.x+this.C.x,this.y+this.C.y),this.remove())}}const j=[0,1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,18,19,20,21,22,24,25,26,27],S=t=>j.includes(t);!function(t){let i=function(t,i,s=!0){let h=document.createElement("canvas");s&&h.classList.add("pixelated");let n=h.getContext("2d");const r=()=>{h.width=t,h.height=i,n.imageSmoothingEnabled=!s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new e(h,n)}(320,180,!0);t.appendChild(i.canvas),v(i)}(document.getElementById("app"));
